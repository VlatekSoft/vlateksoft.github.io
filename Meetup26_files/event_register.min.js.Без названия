var __extends=this&&this.__extends||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},TWF2;!function(TWF2){var WidgetPrototypes;!function(WidgetPrototypes){var event_register=function(_super){function event_register(e){this.eventCache={},this.defaultQuestions=[],this.flags={multiankSelectsReplaced:!1,reportedFillFormEvent:!1,loadingEvent:!1,ankInitialized:!1},this.lazyPackages={postprocessRecurringEvent:["momentjs"]},this.packages=["jquery","mustache"],TWF2.packages.polyfills&&this.packages.push("polyfills"),this.routes={main:{},success:{},tlen:{},pending:{},pay:{},charity:{},button:{},widget_error:{},select_date:{},tickets:{}},this.settings={protocol:"https:",iframe:{width:"100%",height:200,autoHeight:!0,background:"transparent"},use_ticket_remind:!0,popup:{width:600,autoShrink:!0,minViewport:310,closeConfirm:{texts:{title:"Закончить регистрацию?",description:"После этого вернуть введенные вами данные будет невозможно.",close:"Завершить",proceed:"Нет, продолжить"},routes:["main","pay"]},tintColor:"rgba(0,0,0,.8)"},addFormData:{},utmForward:!0,forwardReferer:!0,forwardZeroReferer:"auto",buttonSettings:{css:{},text:null,height:44},mainFormButtonSettings:{texts:{proceed:"Продолжить",buy:"Купить",buy_ticket:"Купить билет",items:["билет","билеты"],register:"Зарегистрироваться",atleast:"Выберите хотя бы один билет"}},display:"iframe",multiankSettings:{addFirstAttendee:!1,distinguishFirstAttendee:!0,initialSelects:!0},trackers:{cube:{enable:!1,sig:"4f08dd3ecb2d2c9e66037e2628389ec9"},ref:{enable:!0},ga:{enable:!0,trackerName:"tpw",trackerId:"UA-5678806-1"}},load_org_trackers:!0,forwardCookies:["in_campaigns","__utmz"],hideFormsWhenNoTickets:!0,hidePromocodeInput:"on-prefill",recurringDatesMode:"auto",recurringShowEmptyIntervals:!1,recurringVerticalCompress:1,cloudPaymentKey:null,issueTickets:!0,prefill:{aux:{},auto:!0,auto_prefix:"twf_prefill_"},use_plusminus:!0,plusminus_burst_protection:"auto",locale:null,dada_config:{api_key:"a609805753dd760bf5699c79cd036e5014f84ce3",type:"PARTY",count:4}},_super.call(this,e)}return __extends(event_register,_super),event_register.prototype.ready=function(){var _this=this,w=this,m=this.model,co=this.customizationOwner,s=this.settings,F=TWF2.Util.F,C=TWF2.Collections,U=TWF2.Util,l=this.mklog("ready"),el,sel;if(C.H.each(this.lazyPackages,function(e){return _this.context.loadPackages(e,function(){})}),m.host=w.context.base,m.event=TWF2.cascade(m.event||{},s.event),m.wclasses=s.widgetClass,m.prefill=s.prefill,m.formData={},m.enteredPromocodes=[],m.isInTimepad=0<=document.location.href.search(this.context.baseDomain)&&!this.settings.iframe.useVkScroll,m.isInPaymentPage=s.isInPaymentPage,m.showEventDetailsAtPayment=s.showEventDetailsAtPayment||"pay"===s.initialRoute,m.prefill.auto){var pfl=this.mklog("auto_prefill");pfl("Auto-prefill from url ENABLED");var url=this.getEmbedderUrl(),qs=U.QueryString.fromUrl(url),rx_1=new RegExp("^"+this.settings.prefill.auto_prefix),prefill_fragments=C.H.where(qs.fragments,function(e,t){return!!t.match(rx_1)}),rebuilt_qs_pairs_1=[],rebuilt_qs=void 0;if(pfl("Processed url: %s, fragments extracted: %O",url,prefill_fragments),C.H.each(prefill_fragments,function(e,t){rebuilt_qs_pairs_1.push(t.replace(rx_1,"")+"="+encodeURIComponent(e))}),rebuilt_qs=rebuilt_qs_pairs_1.join("&"),pfl("Rebuilt queryString for deparam: %s",rebuilt_qs),U.QueryString.deparam){var deparamed_prefill=U.QueryString.deparam(rebuilt_qs);pfl("Decoded prefills: %O",deparamed_prefill),this.settings.prefill=TWF2.extend(this.settings.prefill,deparamed_prefill)}else pfl("Old loader.ts stuck in cache, no deparam available yet :(")}if(m.event&&m.event.locale){var setLoc=this.settings.locale||m.event.locale;l("Setting locale to %s",setLoc),this.switchLocale(setLoc)}(!co&&m.event.org&&(l("Applying customization owner org: %d",m.event.org),this.customizationOwner={ownerType:"organization",id:m.event.org}),w.obs.listen("switchedToNewRenderTarget",function(){l("Default switchedToNewRenderTarget handler fired, setting $.ons"),w.$currentDocumentNode.on("submit","#eventreg_form",function(e){return _this.eventRegister(e)}),w.$currentDocumentNode.on("click",".promocode_link a",function(e){return _this.askPromocode(e)}),w.$currentDocumentNode.on("submit",".js-section-promocodeBlock",function(e){return _this.handleApplyPromocode(e)}),w.$currentDocumentNode.on("change",".js-tickets_count_input,.b-reg-table__select",function(e){return _this.handleTicketsSelection()}),w.$currentDocumentNode.on("click","a.redirect",function(e){return _this.handleRedirectingA(e)}),w.$currentDocumentNode.on("click","a.add-attendee",function(e){return _this.handleAddAttendeeForm(e)}),w.$currentDocumentNode.on("click","a.add-attendees",function(e){return _this.addAttendeeForms(e)}),w.$currentDocumentNode.on("click",".js-date-choice",function(e){return _this.handleSelectEventDate(e)}),w.$currentDocumentNode.on("click",".js-open-date-choice",function(e){return _this.handleOpenSelectEventDate(e)}),w.$currentDocumentNode.on("click","button.open_widget",function(e){return _this.handleOpenWidgetInPopup(e)}),w.$currentDocumentNode.on("change","#eventreg_form input, #eventreg_form textarea",function(e){return _this.handleReportFillForm()}),w.$currentDocumentNode.on("click",".b-payment__event-more-link",function(e){return _this.handleToggleImageHeader(e)}),w.$currentDocumentNode.on("click",".js-schk-wrap_preview",function(e){_this.openSeatcheckModal(),e.preventDefault()}),w.$currentDocumentNode.on("change",".js-section-ank input",F.once(_this,function(e){return _this.notifyTrackers("edited field eventRegister")})),w.$currentDocumentNode.on("click","a.b-payment__method",function(e){return _this.notifyTrackers("clicked button eventPaymentTypes",{event_value:_this.model.order.payment.sum_org})}),w.$currentDocumentNode.on("click",".send-pay-request a",function(e){return _this.sendPayRequest(e)}),w.$currentDocumentNode.on("click","#places_list .close",function(e){return _this.removePlaceFromList(e)}),w.$currentDocumentNode.on("change",'input[name="accepted_terms"]',function(){return _this.processSeletedTickets()}),w.$currentDocumentNode.on("click",".js-section-submit",function(e){return _this.showTermsAcceptPopup(e)}),w.$currentDocumentNode.on("change",'[name="user_forms[0][mail]"], [name="order_mail"]',function(e){_this.model.event&&_this.model.event.policy_features&&_this.model.event.policy_features.email&&_this.recountSelectedTickets()}),w.$currentDocumentNode.on("click",".js-verify-btn, .js-verify-resend",function(e){return _this.handlePhoneVerifySend(e)}),w.$currentDocumentNode.on("change keyup",".js-verify-code",function(e){return _this.handlePhoneVerifyInput(e)}),w.$currentDocumentNode.on("change keyup",".js-verify-phone",function(e){return _this.handlePhoneRequiresVerificationChange(e)}),w.$currentDocumentNode.on("click",".js-charity-show",function(e){return _this.handleCharity(e,"show")}),w.$currentDocumentNode.on("click",".js-charity-hide",function(e){return _this.handleCharity(e,"hide")}),w.$currentDocumentNode.on("change",".js-charity-checkbox",function(e){return _this.handleCharity(e,"checkbox")}),w.$currentDocumentNode.on("click",".js-vkpay",function(e){return _this.handleShowVKPay(e)}),_this.loadSvoge(_this.currentWindowNode)}),w.obs.listen("postRepaint",function(e){var t=!1;if("main"==e.tpl){if(_this.settings.use_plusminus){var i={logger:_this.mklog("plusminus"),allow_zero_below_min:!0},r=navigator.userAgent.toLowerCase(),n=r.indexOf("chrome")<0&&0<r.indexOf("safari")&&r.substr(r.indexOf("version/")+"version/".length,3);"auto"===_this.settings.plusminus_burst_protection?i.burst_timeout=_this.model.event.uses_policies?500:200:i.burst_timeout=+_this.settings.plusminus_burst_protection,TWF2.Util.isMobileBrowser()&&(i.logger("it's a mobile device, disable hovers"),_this.$$(".b-reg-table__plusminus_btn").removeClass("not-touch")),TWF2.JQueryCommon.$plusMinus(_this.$$(".js-plusminus"),i,function(r,n){var e=_this.model.event.tickets_left;if(!e)return n;var o=0;return _this.$$(".js-plusminus").each(function(e,t){if(t==r.get(0))o+=n;else{var i=_this.T$(t).find(".js-plusminus_value").val();o+=+i||0}}),e<o?n-(o-e):n}),n&&n<9&&_this.$$(".js-svoge-fallback").TWFiter(function(e){var t=_this.T$("<span></span>").addClass("b-reg-table__plusminus_fallback");e.hasClass("js-plusminus_plus")?t.text("+"):e.hasClass("js-plusminus_minus")&&t.text("-"),e.html(t).removeClass("js-svoge-fallback")})}if(w.model.event.uses_multiank&&(_this.log("[Recounts] postRepaint multiank update"),_this.flags.multiankSelectsReplaced=!1,w.model.attendees.length&&w.addAttendeeFormHandlers(w.$$(".b-attendee"),w.model.attendees[0])),w.model.event.has_active_places&&(_this.loadSeatcheck(),t=!0,w.settings.iframe.useVkScroll&&window.VK))try{_this.log("[postRepaint][VK] override onScrollTop callback"),window.VK.init(function(){window.VK.addCallback("onScrollTop",function(e,t,i,r){_this.currentWindowNode.seatcheck&&(i=100<i?100:i,_this.currentWindowNode.seatcheck.vkMaxHeight=t-i,_this.currentWindowNode.seatcheck.vkOffset=i,_this.log("[Seatcheck][VK] max height is set"))}),window.VK.addCallback("onScroll",function(e,t){if(_this.currentWindowNode.seatcheck){var i=_this.currentWindowNode.seatcheck.vkOffset;_this.currentWindowNode.seatcheck.vkScroll=0<e-i+42?e-i+42:0,_this.log("[Seatcheck][VK] scroll recalculated")}}),window.VK.callMethod("scrollSubscribe",!0)})}catch(e){_this.log("[postRepaint][VK] onScrollTop callback overriding failed: "+e)}t||_this.recountSelectedTickets(),w.model.event.uses_file_upload&&_this.loadUploadcare(),_this.model.event.uses_phone&&_this.loadTPPhone().done(function(){return _this.$$("[data-type=phone] input.js-tpphone").tpphone()}),C.A.any(_this.model.event.questions,function(e){return e.meta.dadata})&&_this.attachDadata()}w.$$(".b-reg-descr, .b-registration__notice").find("a").attr("target","_blank")}),w.obs.listen("attendeeFormAdded",function(){C.A.any(_this.model.event.questions,function(e){return e.meta&&e.meta.dadata})&&_this.attachDadata()}),this.settings.addModelCache)&&(l("Injecting model cache"),TWF2.Collections.H.each(this.settings.addModelCache,function(mId,k){sel="script#"+mId,_this.log("[POSTINIT] preloading model cache: "+k+" <= "+sel),el=_this.T$(sel).get(0),_this.eventCache[k]=eval(_this.context.loader.extractScriptSrc(el))}));"button"===this.settings.initialRoute&&(l("Initial route = button, overriding iframe stuff"),this.settings.iframe.autoHeight=!1,this.settings.iframe.height=this.settings.buttonSettings.height,this.settings.iframe.background="transparent"),"squish"===this.settings.recurringDatesMode&&(l("Overriding squishRecurringDates"),this.model.squishRecurringDates=!0),this.obs.listen("seatcheckReady",function(){_this.model.event.uses_preloader?_this.initializePreloader():_this.loadSeatcheckData(),_this.settings.iframe.useVkScroll&&window.VK&&window.VK.callMethod("scrollTop")}),this.obs.listen("trackingWidgetLoaded",F.once(this,function(){return _this.notifyTrackers("loaded form eventRegister",{none_interactive:!0})})),this.T$.ajaxSetup({timeout:5e4}),this.loadOrgTrackers(),_super.prototype.ready.call(this)},event_register.prototype.main=function(e,r){var n=this,o=this,s=this.mklog("main route"),a=TWF2.Collections,t=e.event_id||this.model.event.id;if(s("Loading event #%d",t),this.model.enteredLegacyPromocode=null,this.model.lastUserInputtedPromocode=null,this.model.hidePromocodeInput="always"===this.settings.hidePromocodeInput,e.event_id&&e.event_id!=this.model.event.id&&this.model.selectedRecurringEvent&&this.model.selectedRecurringEvent.id!=t){s("We have recurring event %d selected, trying to select %d as recurring too",this.model.selectedRecurringEvent.id,t);try{this.selectRecurringEvent(t)}catch(e){this.model.selectedRecurringEvent=null}}var i={event:t};this.settings.locale&&(i.locale=this.settings.locale),this.settings.prefill&&this.settings.prefill.promocodes&&(s("Promocode prefill set: %O",this.settings.prefill.promocodes),i.promocode=this.settings.prefill.promocodes[0],this.model.enteredLegacyPromocode=this.settings.prefill.promocodes[0],this.model.enteredPromocodes=this.settings.prefill.promocodes,"on-prefill"===this.settings.hidePromocodeInput&&(s("Configured to hide promocode input on prefill"),this.model.hidePromocodeInput=!0)),s("Requesting event"),o.getEvent(i,function(){if(s("Got event"),n.obs.fireEvent("trackingWidgetLoaded",{}),n.switchLocale(n.settings.locale||n.model.event.locale),o.model.event.is_recurring){s("Event is recurring");var t=n.model.prefill.recurringEvent;if(!n.model.selectedRecurringEvent&&t){if(s("Trying to select prefilled recurring event #%d",t),a.A.whereSingle(n.model.event.recurring_events,function(e){return e.id==t&&!e.unavaliable}))return n.selectRecurringEvent(t),void n.route("main",{event_id:t});s("Could not find prefilled recurring event")}if(!n.model.selectedRecurringEvent)return s("No recur date selected, rerouting"),n.currentTpl=null,void n.route("select_date");if(!o.model.event.reg_open){s("This recurring event instance is closed, trying to substitute with open one");var i=null;if(o.T$.each(o.model.event.recurring_events,function(e,t){return!!t.unavaliable||(i=t.id,!1)}),i)return void n.route("main",{event_id:i})}}if(!o.model.event.reg_open)return s("Event is closed, rerouting"),n.currentTpl=null,void n.route("tlen");n.checkVKPay()&&(n.model.show_vkpay_button=!0),r(),n.gaTrackVirtualUrl("eventreg_widget/"),n.notifyTrackers("opened form eventRegister",{non_interactive:!e.as_popup&&!n.settings.isInEventListWidget&&!n.model.event.is_recurring}),n.settings.isInEventPage||o.notifyTrackers("view_event",{selective_trackers:["ref"]})})},event_register.prototype.success=function(e,t){if(this.settings.issueTickets&&this.model.order&&this.model.order.has_tickets)return this.model.order.diploma_url=this.model.order.diploma_url+"?utm_campaign=tp_diploma_promo&utm_medium=tpd_widget&utm_source=tp_screen_tickets_ok",void this.route("tickets");t(),this.notifyTrackers("visited page eventRegisterConfirm"),this.gaTrackVirtualUrl("eventreg_widget/success/"),this.model.event.uses_reg_ok_redirect&&document.location.replace(this.model.event.reg_ok_redirect)},event_register.prototype.tickets=function(e,t){var n=this;t(),this.$$(".js-tickets .js-print-ticket").click(function(e){var t=n.mklog("print ticket"),i=+n.T$(e.currentTarget).parents(".js-ticket").data("ticket-id"),r=TWF2.Collections.A.whereSingle(n.model.order.tickets,function(e){return e.id==i}).print_link;t("Printing ticket from url"),n.waitFor(function(e){n.printUrl(r,e)})}),this.model.order.payment?this.notifyTrackers("visited page eventPaymentConfirm",{event_value:this.model.order.payment.sum_org}):this.notifyTrackers("visited page eventRegisterConfirm"),this.gaTrackVirtualUrl("eventreg_widget/tickets/"),this.model.event.uses_reg_ok_redirect&&document.location.replace(this.model.event.reg_ok_redirect)},event_register.prototype.tlen=function(e,t){t()},event_register.prototype.pending=function(e,t){t(),this.gaTrackVirtualUrl("eventreg_widget/pending/")},event_register.prototype.pay=function(e,t){var i=TWF2.Collections.A,r=this.mklog("pay");if(this.model.event.locale_ru=!(!this.model.event.locale||"ru"!=this.model.event.locale),this.checkVKPay()&&this.model.order.vk_pay_params&&(this.model.show_vkpay_button=!0,this.model.order.payment.cardPaymentActive=!1),this.settings.prefill&&this.settings.prefill.payment){var n=this.settings.prefill.payment;r("Payment type prefilled to %s",n.key);var o=i.whereSingle(this.model.order.payment.paymentMethods.link,function(e){return e.methodKey==n.key});if(o){if(r("Found prefilled payment method, redirecting to %s",o.url),!n.redirect_inside)return this.redirectTo(o.url);this.currentWindowNode.location.replace(o.url)}}t(),this.model.order.payment.cardCloudPaymentActive&&(r("Initializing cloudpay"),this.initPayForm()),this.initializeTimer(),this.notifyTrackers("opened form eventPaymentTypes",{event_value:this.model.order.payment.sum_org}),this.gaTrackVirtualUrl("eventreg_widget/pay/")},event_register.prototype.charity=function(e,t){TWF2.Collections.A;var i=this.mklog("charity");t(),this.model.order.payment.cardPaymentActive&&(i("Initializing cloudpay"),this.initPayForm()),this.gaTrackVirtualUrl("eventreg_widget/charity/")},event_register.prototype.initializeTimer=function(){var r,n,t=this,o=this.mklog("timer"),s=this.$$(".js-timer-clock"),a=this.$$(".js-timer"),i=this.$$(".js-timer-retry-btn");if(s.length){var e=function(){var e=r-Date.now(),t=Math.floor(e/1e3%60),i=Math.floor(e/1e3/60%60);s.text(("0"+i).slice(-2)+":"+("0"+t).slice(-2)),t<=0&&i<=0&&(o("Countdown reached."),clearInterval(n),a.addClass("js-timer_state-retry"))},d=function(){r=Date.now()+12e5,e(),n=setInterval(e,500)};d(),i.click(function(){var e;o("W4 random countdown..."),i.addClass("twf-2-timer__retry-btn_state_loading").addClass("disabled"),setTimeout(t.startWaitingFor(function(){o("Restarting the timer"),a.removeClass("js-timer_state-retry"),i.removeClass("twf-2-timer__retry-btn_state_loading").removeClass("disabled"),d()}),400<(e=1e3*Math.random())?e+1e3:1337)})}else o('Can\'t find timer element with ".js-timer-clock"')},event_register.prototype.prepareCardPayment=function(e){if("cloudpayments"!=e&&"orgcloudpayments"!=e)return null;this.$$('[data-cp="expDateMonthYear"]').val(this.$$("#card-validity-month option:selected").val()+"/"+this.$$("#card-validity-year option:selected").val());var t=this.createCryptogram();return{name:this.$$('[name="name"]').val(),hash:t}},event_register.prototype.initPayForm=function(a){var d=this;a||(a=this.model.order.payment),this.settings.cloudPaymentKey=TWF2.Collections.A.whereSingle(a.paymentMethods.card,function(e){return("cloudpayments"==e.methodKey||"orgcloudpayments"==e.methodKey)&&!!e.key.length}).key,this.loadCloudPay();for(var t=this.$$("#card-number"),i=this.$$('[name="name"]'),e=this.$$("#card-validity-year"),r=(new Date).getFullYear(),n=0;n<=15;n++)e.append('<option value="'+(r+n)+'">'+(r+n)+"</option>");t.keyup(function(e){t.val(function(e,t){return function(e){var t,i,r=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,20}/g),n=r&&r[0]||"",o=[];for(t=0,i=n.length;t<i;t+=4)o.push(n.substring(t,t+4));return o.length?o.join(" "):e}(t)})}),i.keyup(function(e){i.val(function(e,t){return t.toUpperCase().replace(/([^\w_\-\ ]|[\d])+/g,"")})}),this.$$("#widget_pay").submit(function(e){e.preventDefault();var t=d.$$(".b-pro-wiget__pay-button").blur(),i=function(e){e?t.removeClass("disabled").removeAttr("disabled"):t.addClass("disabled").attr("disabled","disabled")};i(!1);var r=d.startWaitingFor(function(){return i(!0)}),n=d.prepareCardPayment(a.cardPaymentCurrent),o=d;if(n&&n.hash){var s={crossDomain:!0,dataType:"jsonp",url:d.prependConsumerHost("/partners/payment_begin/"+a.cardPaymentCurrent+"/"+a.id+"/",{subdom:d.model.event.subdomain}),data:n,type:"POST"};d.T$.ajax(s).done(function(e){r(),"process"===e.status?d.redirectTo(e.url):"success"===e.status?(o.model.order=e.order,d.route(d.settings.issueTickets?"tickets":"success")):"error"===e.status&&e.error?d.showPayErrors({process:e.error}):"error"===e.status&&d.showPayErrors({process:"Не удалось обработать платёж"})})}else r();return!1})},event_register.prototype.select_date=function(e,t){var s=this,i="select_date",r=TWF2.Collections;if("vertical-days"===this.settings.recurringDatesMode&&(i="select_date_vertical"),t(i),"vertical-days"===this.settings.recurringDatesMode){var n=this.mklog("GridScroller");if(!r.A.arrayCount(this.model.event.recurring_events,function(e){return!e.unavaliable}))return n("No dates, rerouting"),this.currentTpl=null,void this.route("tlen");n("Initializing");var o,a=this.$$(".js-gridscroller"),d=a.find(".js-gridscroller__container"),c=a.find(".js-gridscroller__inner-container"),l=a.find(".js-gridscroller__left"),u=a.find(".js-gridscroller__right"),h=a.find(".js-gridscroller__mover"),m=a.find(".js-gridscroller__cell"),p=m.width(),g=a.find(".js-gridscroller__header").length,f=g*p,v=a.data("disabled-class"),_=this.$$(".js-tooltip");n("Cell width determined as %d",p),n("Mover width determined as %d * %d = %d",g,p,f),h.css("position","relative"),o=h.height(),h.css("position","absolute"),n("Mover height determined as %d",o);var k,y=0,w=0,T=0,b=function(){if(!s.$$(".js-gridscroller").length)return n("Lost scroller element, self-destructing watcher interval"),void window.clearInterval(k);(w=d.width())!=y&&(n("Container width changed %d -> %d, resetting width limiter",y,w),T=Math.floor(w/p)*p,n("Inner cont width := %d",T),c.css({width:T,height:o}),d.css({height:o}),S(0),n("Page count = %d",$())),y=w},$=function(){return Math.ceil(f/T)},C=0,S=function(e){n("Setting page %d",e),e=Math.max(0,e),e=Math.min($()-1,e),n("Pageno after normalization = %d",e),C=e,h.css({left:-e*T}),F()},F=function(){C?(n("We are NOT on zero page, enabling <"),l.removeClass(v)):(n("We are on zero page, disabling <"),l.addClass(v)),C>=$()-1?(n("We are on last page, disabling >"),u.addClass(v)):(n("We are NOT on last page, enabling >"),u.removeClass(v))};b(),k=window.setInterval(b,1e3),l.click(function(){return S(C-1)}),u.click(function(){return S(C+1)});var P=l.height(),W=o/2-P/2;n("Mover height = %d, button height = %d, button top := %d",o,P,W),l.css("top",W),u.css("top",W),m.mouseenter(function(e){var t=s.T$(e.currentTarget),i=s.T$(e.currentTarget).find(".js-date-choice"),r=i.data("event-tickets-left"),n=i.data("event-tickers-reglimit");if(!!r){var o=t.offset();_.find(".js-tooltip-tickets-left").text(r+" из "+n),o.top-=_.height(),o.left+=t.width()/2-_.width()/2,_.offset(o).fadeTo(0,1)}}).mouseleave(function(){_.fadeTo(0,0)})}this.gaTrackVirtualUrl("eventreg_widget/select_date/")},event_register.prototype.button=function(e,r){var n=this,t={response_type:"jsonp",event:this.model.event.id};this.settings.locale&&(t.locale=this.settings.locale),this.loadEventModel(t,function(){var e=n.settings.buttonSettings.text,t=n.settings.mainFormButtonSettings.texts;e||(e=n.model.event.min_price?t.buy_ticket:t.register),r(),n.obs.fireEvent("trackingWidgetLoaded",{});var i=n.$$("button.open_widget").css(n.settings.buttonSettings.css).text(e);(!n.model.event.reg_open&&!n.model.event.is_recurring||n.model.event.is_recurring&&!TWF2.Collections.A.whereSingle(n.model.event.recurring_events,function(e){return!e.unavaliable}))&&i.addClass("disabled")}),this.settings.noScrollToWidgetOnViewChange=!0,this.gaTrackVirtualUrl("eventreg_widget/button/")},event_register.prototype.widget_error=function(e,t){var i="unknown",r=this.context.placeholderURL;e&&e.type&&(i=e.type),this.model.error={unknown:{support:!0,fallback:!0,header:"Неизвестная ошибка",message:"К сожалению, виджету заказа билетов почему-то не удалось загрузиться."},404:{support:!1,fallback:!1,header:"404: Событие не найдено",message:"События для этого виджета не существует. Возможно, оно было удалено."},403:{support:!1,fallback:!1,header:"403: Доступ ограничен",message:"Доступ к запрошенному событию ограничен."},400:{support:!0,fallback:!0,header:"Конфигурация виджета повреждена",message:"Кажется, виджет заказа билетов был установлен неправильно."}}[i],!r&&this.model.event.id&&(r=this.model.widgetInfo.host+"event/"+this.model.event.id),this.model.error.fallback_url=r,t()},event_register.prototype.resetEventModel=function(){var i=this,e=this.mklog("main route"),t=TWF2.Collections;e("Resetting model, states, flags, selectedSeats of seatcheck"),t.H.each(this.flags,function(e,t){return i.flags[t]=!1}),this.model.selectedTickets=null,this.model.selectedTicketByCat=null,this.currentWindowNode.seatcheck&&this.currentWindowNode.seatcheck.i.clearSeatsSelection(),this.model.attendees=[],this.model.policyResult=null,this.model.enteredPromocodes=[],this.model.event=null,this.settings.prefill&&this.settings.prefill.promocodes&&(e("Promocode prefill set (reprefill on reset): %O",this.settings.prefill.promocodes),this.model.enteredLegacyPromocode=this.settings.prefill.promocodes[0],this.model.enteredPromocodes=this.settings.prefill.promocodes)},event_register.prototype.handleToggleImageHeader=function(e){e.preventDefault(),this.T$(e.currentTarget).toggle(),this.$$(".b-payment__event-more").toggleClass("b-payment__event-more_open")},event_register.prototype.handleOpenWidgetInPopup=function(e){var i=this;e.preventDefault(),this.openSwitchToIframePopup({autoHeight:!0,background:"white"},this.settings.popup,function(e,t){i.currentTpl=null,i.route("main",{as_popup:!0}),i.loadCloseConfirm(t)},function(){i.currentTpl=null,i.route("button")})},event_register.prototype.handleAddAttendeeForm=function(e){if(e.preventDefault(),!this.T$(e.currentTarget).hasClass("disabled")){var t,i=parseInt(this.$$(".add-attendee-re select").val()),r=TWF2.Collections.A.whereSingle(this.model.event.tickets,function(e){return e.id==i}),n=TWF2.Collections.A.arrayCount(this.model.attendees,function(e){return e.reId==i});!i||n>=r.max||(t=this.addAttendeeForm(i),this.scrollToElement(t))}},event_register.prototype.handleReportFillForm=function(){this.flags.reportedFillFormEvent||(this.flags.reportedFillFormEvent=!0)},event_register.prototype.handleRedirectingA=function(e){e.preventDefault(),this.context.topmostWindow.location.replace(TWF2.T$(e.currentTarget).attr("href"))},event_register.prototype.handleSelectEventDate=function(e){this.currentWindowNode.seatcheck&&(this.currentWindowNode.seatcheck.i.clearSeatsSelection(),this.updatePlacesList(),this.recountSelectedPlaces());var t=+this.T$(e.currentTarget).data("event-id"),i=this.mklog("[Recurring]");if(t){i("Requested different date: %d",t);try{this.selectRecurringEvent(t)}catch(e){return void i(e)}this.route("main",{event_id:t})}else i("no date selected")},event_register.prototype.selectRecurringEvent=function(t){var e;if(!(e=TWF2.Collections.A.whereSingle(this.model.event.recurring_events,function(e){return e.id==t}))||e.unavaliable)throw"rce can not be accessed";this.model.selectedRecurringEvent=e},event_register.prototype.handleOpenSelectEventDate=function(e){e.preventDefault(),this.route("select_date")},event_register.prototype.askPromocode=function(e){e&&e.preventDefault(),this.$$(".promocode_link").remove(),this.$$(".promocode_form").show()},event_register.prototype.handleApplyPromocode=function(e){var t=this;e&&e.preventDefault();var i,r=this.$$("#promoCode"),n=this.$$("#promocodeInput"),o=(r.find(".b-input-block__promo-btn-text"),this.mklog("promocode-handler")),s=n.val();this.getText.bind(this);if(s&&s.length){if(this.model.lastUserInputtedPromocode=s,o("User-inputted promocode"),i=this.applyPromocode(n.val()),this.model.event.policy_features.promocode){var a=function(e){return function(){t.model.event.promocode_ok=e,t.model.event.promocode_wrong=!e}};i.done(a(!0)).fail(a(!1)).always(function(){t.repaintSection("promocodeBlock")})}}else o("Empty promocode, aborting")},event_register.prototype.handlePromocodeNote=function(){void 0===this.model.ifYouHavePromocode&&(this.model.ifYouHavePromocode=!this.model.event.promocode_locked)},event_register.prototype.applyPromocode=function(e){var t=this,i=TWF2.Collections.A;if(this.model.event.policy_features.promocode){var r=e.split(/[\s,;]+/);return i.each(r,function(e,t){return r[t]=e.trim()}),this.applyPromocodes(i.where(r,function(e){return""!==e}))}var n=this.T$.Deferred(),o=TWF2.microguid(4);return this.elog("promocode","Classic mode",o),this.model.enteredLegacyPromocode=this.model.formData.promocode=e,this.reloadEvent(function(){t.repaint(),n.resolve()}),n},event_register.prototype.applyPromocodes=function(e){var t,i=this,r=TWF2.Collections.A,n=this.T$.Deferred(),o=TWF2.microguid(4),s=this.model.enteredPromocodes.length;return this.elog("promocode","Policy mode",o),this.elog("promocode","Already %s promocodes entered",o,s),r.each(e,function(e){e+="",i.elog("promocode","Applying promocode %s",o,e),i.model.enteredPromocodes.push(e)}),this.model.enteredPromocodes=r.where(this.model.enteredPromocodes,function(e,t){return-1==t.indexOf(e)}),t=this.model.enteredPromocodes.length,this.elog("promocode","Now %s promocodes entered (was %s)",o,t,s),t===s?n.reject():(this.model.formData.promocodes=this.model.enteredPromocodes,this.elog("promocode","Recounting stuff",o),this.recountSelectedTickets().done(function(){r.containsAll(i.model.policyResult.applied_promocodes,e,function(e,t){return e.toLowerCase()==t.toLowerCase()})?(i.elog("promocode","GOOD Promocode is included in applied promocodes list",o),n.resolve()):(i.elog("promocode","BAD Promocode is missing from applied promocodes list",o),n.reject())})),n},event_register.prototype.checkPayForm=function(){var e=this,t=this.$$("#card-validity-year"),i=this.$$("#card-validity-month"),r={},n=function(){return parseInt(t.val())<(new Date).getFullYear()},o=function(){var e=parseInt(i.val());if(parseInt(t.val())==(new Date).getFullYear()&&e<+(new Date).getMonth()+1)return!0;return!1},s=function(){return!!e.$$('#widget_pay [name="name"]').val().match(/([^\w_\-\ ]|[\d])+/)};return!!(o()||n()||s())&&(o()&&(r.expDateMonth="Некорректное значение месяца"),n()&&(r.expDateYear="Некорректное значение года"),s()&&(r.name="В имени владельца карты допущены ошибки"),r)},event_register.prototype.createCryptogram=function(){if(!window.checkout)return null;var e=TWF2.Collections.H,t=this.checkPayForm(),i=(this.$$("#pay_errors"),function(){return window.checkout.accessorMap}),r={},n=function(){e.each(i(),function(e,t){return t&&(i()[t]=r[t])})};e.each(i(),function(e,t){return t&&(r[t]=e)});var o=window.checkout.createCryptogramPacket();if(o.success&&t)n(),this.showPayErrors(t);else{if(o.success)return o.packet;o&&o.messages?(o.messages=TWF2.extend(o.messages,t),o.messages&&o.messages.expDateMonth&&(o.messages.expDateMonth="Некорректное значение месяца"),o.messages&&o.messages.expDateYear&&(o.messages.expDateYear="Некорректное значение года"),o.messages&&o.messages.name&&(o.messages.name="В имени владельца карты допущены ошибки"),n(),this.showPayErrors(o.messages)):t&&(n(),this.showPayErrors(t))}return null},event_register.prototype.showPayErrors=function(e){var r=this,i=TWF2.Collections.H,n=this.$$("#pay_errors"),o=this.getText.bind(this),s={expDate:["#card-validity-month","#card-validity-year"],expDateYear:["#card-validity-year"],expDateMonth:["#card-validity-month"],name:['#widget_pay [name="name"]'],cardNumber:["#card-number"],cvv:["#card-cvc"]};n.empty(),i.each(s,function(e,t){for(var i in e)r.$$(e[i]).removeClass("payform-error")}),i.each(e,function(e,t){n.append("<li>"+o(e)+"</li>"),s[t]&&i.each(s[t],function(e){r.$$(e).addClass("payform-error")}),n.is(":visible")||n.show()})},event_register.prototype.applyCloudPay=function(){window.cp&&(window.checkout=new cp.Checkout(this.settings.cloudPaymentKey,this.$$("#widget_pay").get(0)),this.log("[CloudPay] apply widgets"))},event_register.prototype.applyUploadcare=function(){window.uploadcare&&(this.log("[Uploadcare] apply widgets"),this.$$("#eventreg_form input[role='uploadcare-uploader-outer']").TWFiter(function(e){return window.uploadcare.Widget(e)}))},event_register.prototype.loadCloudPay=function(){var e=this,t=["https://widget.cloudpayments.ru/bundles/checkout"],i=function(){e.log("[CloudPay] library ready"),e.applyCloudPay()};this.appendJS(t),window.cloudPay?i():(this.log("[CloudPay] loading library"),this.context.loader.includeJS(t,i))},event_register.prototype.loadUploadcare=function(){var i=this,e=["https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"],t=function(){i.log("[Uploadcare] library ready"),i.applyUploadcare()},r=function(e,t){window[e]=t,i.currentWindowNode[e]=t};r("UPLOADCARE_LIVE",!1),r("UPLOADCARE_LOCALE",this.locale),r("UPLOADCARE_PUBLIC_KEY",this.model.event.uc_publickey),this.appendJS(e),window.uploadcare?t():(this.log("[Uploadcare] loading library"),this.context.loader.includeJS(e,t))},event_register.prototype.loadTPPhone=function(){return this.T$.Deferred().resolve()},event_register.prototype.attachDadata=function(){var c=this,l=this.mklog("Dadata attach");this.loadDadata().done(function(){c.$$(".b-reg-row.js-dadata").TWFiter(function(e){l("Attaching to %O",e),e.removeClass(".js-dadata");var t=e.data("tag"),i=TWF2.Collections.A.whereSingle(c.model.event.questions,function(e){return e.tag===t}),r=e.find("input");if(i){l("Matching question: %s - %O",t,i);var n=i.meta.dadata,o={token:c.settings.dada_config.api_key,addon:"spinner"};"org"===n.preset?(TWF2.T$.extend(o,{token:c.settings.dada_config.api_key,type:"PARTY",count:4,scrollOnFocus:!1}),n.prefill_org&&(o.onSelect=function(e){c.settings.prefill.aux.inn=e.data.inn,c.settings.prefill.aux.kpp=e.data.kpp,c.settings.prefill.aux.address=e.data.address?e.data.address.value:null,c.settings.prefill.aux.short_with_opf=e.data.name?e.data.name.short_with_opf:null})):"city"===n.preset&&TWF2.T$.extend(o,{type:"ADDRESS",bounds:"city",constraints:{label:"",locations:{city_type_full:"город"}},hint:!1,count:4,scrollOnFocus:!1,formatSelected:function(e){return e.data.city},formatResult:function(e,t,i){return i.data.city}}),n.fill_key&&(o.formatSelected=function(e){return e.data[n.fill_key]}),n.settings&&TWF2.T$.extend(o,n.settings);var s={$reg_row:e,q:i,ddc:n,dadata_settings:o};c.obs.fireEvent("preDadataAttach",s),r.suggestions(o),c.obs.fireEvent("postDadataAttach",s);var a=r.suggestions();if(a&&(a.$viewport=TWF2.T$(c.currentWindowNode),"city"===n.preset&&n.geolocation)){l("Geolocation enabled, attempting!");var d=a.getGeoLocation();d&&d.done(function(e){l("Got geoloc %O",e),e&&e.city&&r.suggestions().setSuggestion({value:e.city,data:e})})}}else l("ERROR no matching question for %s",t)})})},event_register.prototype.loadDadata=function(){var e=this,t=this.mklog("Dadata"),i=this.currentWindowNode,r=new TWF2.MassLoader,n=this.T$.Deferred();return this.T$.fn.suggestions?(t("Dadata js already present"),n.resolve()):(t("Loading dadata suggestions"),i.jQuery=this.T$,i.$=this.T$,i.TimepadWF=TWF2,this.appendJS(["https://cdn.jsdelivr.net/npm/suggestions-jquery@17.12.0/dist/js/jquery.suggestions.min.js"],r.addEvent("suggestions-js")),r.wait(function(){t("Dadata ready!"),e.obs.fireEvent("dadataReady",{}),n.resolve()}),n)},event_register.prototype.loadSeatcheck=function(){var e,t=this,i=this.currentWindowNode,r=[],n=this.mklog("Seatcheck");n("loading library"),this.appendCSS([this.prependConsumerHost("css/seatcheck.css")]),e=[this.prependConsumerHost("js/seatcheck.js"),this.prependConsumerHost("js/svoge.js")],r.push(this.prependConsumerHost("js/lib/jquery/1.9.1/jquery.min.js"),this.prependConsumerHost("js/lib/d3/3.4.9/d3.min.js"),this.prependConsumerHost("js/lib/detectmobilebrowser/0.0.1/detectmobilebrowser.min.js")),this.model.selectedSeatedTickets=[],this.appendJS(r,function(){t.appendJS(e,function(){n("overriding handlers"),i.seatcheck.i.updateTicketsAlertBlock=t.handleSeatcheckUpdate.bind(t),i.tpgettext=t.getText.bind(t),i.svoge=new i.Svoge(t.getSvogeConfig()),t.obs.fireEvent("seatcheckReady",{seatcheck:i.seatcheck})},!0)})},event_register.prototype.handleSeatcheckUpdate=function(t,e){var i=this.mklog("Seatcheck"),r=TWF2.Collections.A,n=r.whereSingle(this.model.event.seatedTickets,function(e){return e.id==+t.catId}),o={cat:n,place:t};if(i("Processing seatcheck change"),this.setFormSelectedTickets(null,["checkbox"]),this.model.event.uses_multiank)if(e)this.model.selectedSeatedTickets.push(o),this.flags.multiankSelectsReplaced&&(i("Multiank - adding new form"),r.whereSingle(this.model.attendees,function(e){return e.isSeated&&e.seatedInfo.place.id==o.place.id})||this.addAttendeeForm(+n.id,{seatcheck:o}));else if(r.removeWhere(this.model.selectedSeatedTickets,function(e){return e.place.id==o.place.id}),this.flags.multiankSelectsReplaced){i("Multiank - REMOVING form");var s=r.whereSingle(this.model.attendees,function(e){return e.isSeated&&e.seatedInfo.place.id==o.place.id});s&&this.removeAttendee(s)}this.recountSelectedTickets(),this.recountSelectedPlaces(),this.updatePlacesList()},event_register.prototype.removePlaceFromList=function(e){var t=e.target,i=this.T$(t).parents(".b-reg-table__row").attr("id").match(/seat_cont_(\d+)/),r=i&&+i[1];r&&this.currentWindowNode.seatcheck.i.removeSeatSelectionById(r,!1)},event_register.prototype.updatePlacesList=function(){var i=this,r=TWF2.Collections.A,n=this.$$("#places_list"),e=n.parents(".b-registration__section"),t=this.currentWindowNode.seatcheck.i.getSelectedData();n.children().remove(),t.length?(t.forEach(function(t){var e={cat:r.whereSingle(i.model.event.seatedTickets,function(e){return e.id==+t.catId}),place:t};e.placeHuman=i.getHumanPlace(e.place.d),i.renderTemplate("_seat_info",e).appendTo(n)}),e.show()):e.hide()},event_register.prototype.loadSeatcheckData=function(e,t){var i=this;void 0===e&&(e={});var r=this.currentWindowNode,n=(this.getText.bind(this),TWF2.cascade({promocode:this.model.enteredLegacyPromocode,locale:this.locale},e)),o={crossDomain:!0,dataType:"jsonp",url:this.prependConsumerHost("/event/get_seats/"+this.model.event.id+"/jsonp/",{subdom:this.model.event.subdomain}),data:n,method:"GET"};this.log("[Seatcheck] loading seats"),this.T$.ajax(o).done(t||function(e){i.log("[Seatcheck] rendering"),i.$$(".schk-loader").detach(),i.$$(".js-schk-wrap__cover-btn-wrap").show(),r.seatcheckIsMobilePlatform&&i.$$(".js-schk-wrap_preview").addClass("schk-wrap_mobile-preview"),r.seatcheck.setData(e).setElement(i.$$(".schk-wrap").get(0)).appendOptions({eventregForm:i.$$("#eventreg_form").get(0),event:{multireg:i.model.event.uses_multireg},seats:{maxRescale:5}}).draw(),i.model.attendees.length||i.model.event.uses_multiank||i.addAttendeeForm(),i.model.event.seatedTickets=r.seatcheck.data.cats||[],i.recountSelectedTickets()})},event_register.prototype.initializePreloader=function(){var t=this,e={crossDomain:!0,dataType:"jsonp",url:this.prependConsumerHost("/event/get_preloader/"+this.model.event.id,{subdom:this.model.event.subdomain}),method:"GET"};this.T$.ajax(e).done(function(e){t.currentWindowNode.seatcheck.p.setElement(t.$$(".schk-wrap").get(0)).setData(e).setActiveSectors(t.model.event.active_sectors).setLayers().draw().createTooltip().makeInteractive(t.openSeatcheckModal.bind(t)),t.$$(".schk-loader").hide(),t.model.attendees.length||t.model.event.uses_multiank||t.addAttendeeForm(),t.model.event.seatedTickets=[],t.recountSelectedTickets()})},event_register.prototype.openSeatcheckModal=function(p){var g=this,e=this.currentWindowNode.seatcheck,f=this.model.event.uses_preloader;if(e.opening)this.log("[Seatcheck] trying to open modal twice");else{e.opening=!0;var t=this.currentWindowNode.seatcheckIsMobilePlatform,i=this.T$(window),r=[i.innerWidth(),i.innerHeight()],v=t?window.innerWidth/window.screen.width:1,n=0,w=t||r[0]<=900,_=w?window.innerHeight:r[1]-60;if(this.settings.iframe.useVkScroll&&window.VK){var o=e.vkMaxHeight||_;_=t?o:o-60,n=e.vkScroll+15}if(window.screen&&window.screen.height){var s=(window.screen.height-112)*v;s<_&&(_=s)}var k,y,a={height:_},d={width:w?r[0]:r[0]-15,closeCss:{color:"#A8A8A8",top:"27px",right:"27px"},autoShrink:!0,padding:w?0:15,additionalClose:".js-proceed-btn",noClose:w,addCss:{"box-sizing":"border-box",border:"0 none"},horizontallyScrolled:w,tintColor:this.settings.popup.tintColor};n&&(d.addCss.top=n),this.context.createIframePopup(a,d,function(t,i,r){var e=g.$$("head").children("link,style").clone(),n=g.currentWindowNode.svoge.element.clone(),s=g.T$(i),o=g.currentWindowNode.seatcheck;s.find("head").append(e),s.find("body").append(n);var a=g.renderTemplate("_seatcheck_modal",g.model),d=a.find(".schk-loader_full"),c=d.find(".schk-loader__text");w&&a.addClass("schk-modal_mobile"),k=g.$$(".schk-fixator"),y=g.$$(".schk-wrap"),f||(k.css("height",_),y.detach(),y.addClass("schk-wrap_stretched"),y.removeClass("schk-wrap_bounded"),a.find(".schk-scheme__scheme").append(y)),g.T$(t).append(a.css({height:g.T$(r).height()/v,width:g.T$(r).width()/v}));var l=function(){o.scale.outer=v;var e=g.T$.Deferred();if(o.createLegend(a[0],e,w),w){var _=!1,k=0,y=0;s.on("touchstart",".schk-modal__legend",function(e){_=!0;var t=e.originalEvent.touches[0];y=t.pageX,k=$(e.currentTarget).position().left}).on("touchend",".schk-modal__legend",function(){_=!1}).on("touchmove",".schk-modal__legend",function(e){if(_){var t=e.originalEvent.touches[0].pageX,i=k+-(y-t),r=$(e.currentTarget).closest(".schk-modal__legend-wrap-mobile"),n=r.innerWidth()-$(e.currentTarget).innerWidth(),o=r.find(".schk-modal__arrow_left"),s=r.find(".schk-modal__arrow_right"),a=r.closest(".schk-modal__legend-wrap").find(".schk-modal__advancer-arrow_left"),d=r.closest(".schk-modal__legend-wrap").find(".schk-modal__advancer-arrow_right");if(n<0){n<=i&&i<=0&&$(e.currentTarget).css({left:i}),0<i&&(o.hide(),$(e.currentTarget).css({left:0})),i<n&&(s.hide(),$(e.currentTarget).css({left:n}));var c=(l=$(e.currentTarget),h=(u=r).position(),m=Math.floor(u.position().left+u.outerWidth()),p=Math.floor(h.left),g=l.position(),f=Math.floor(l.position().left+l.outerWidth()),(v=Math.floor(g.left))<p&&m<f?"both":v<p?"left":m<f?"right":"none");"both"==c?(o.show(),s.show(),a.show(),d.show()):"left"==c?(o.show(),s.hide(),a.show(),d.hide()):"right"==c&&(o.hide(),s.show(),a.hide(),d.show())}}var l,u,h,m,p,g,f,v}).on("click",".schk-modal__advancer-arrow_right",function(e){var t=$(e.currentTarget).parents(".schk-modal__legend-wrap"),i=t.find(".schk-modal__legend-wrap-mobile"),r=i.innerWidth(),n=t.find(".schk-modal__legend"),o=t.find(".schk-modal__legend").children(".legend__cat"),s=0,a=Math.floor(i.innerWidth()/2),d=i.find(".schk-modal__arrow_left"),c=i.find(".schk-modal__arrow_right"),l=t.find(".schk-modal__advancer-arrow_left");g.T$.each(o,function(e,t){s+=$(t).outerWidth(!0)});var u=n.position().left+s;u-r<1.2*a&&(a=u-r,$(e.currentTarget).hide(),c.hide()),l.is(":hidden")&&(l.show(),d.show());var h=n.position().left-a;n.animate({left:h},150)}).on("click touchend",".schk-modal__advancer-arrow_left",function(e){var t=$(e.currentTarget).parents(".schk-modal__legend-wrap"),i=t.find(".schk-modal__legend-wrap-mobile"),r=t.find(".schk-modal__legend"),n=Math.floor(i.innerWidth()/2),o=r.position().left+n,s=t.find(".schk-modal__advancer-arrow_right"),a=i.find(".schk-modal__arrow_left"),d=i.find(".schk-modal__arrow_right");s.is(":hidden")&&(s.show(),d.show()),Math.abs(r.position().left)<1.2*n&&(o=0,$(e.currentTarget).hide(),a.hide()),r.animate({left:o},150)})}e.done(function(){o.options.panels.right=36,o.drawer.rescaleSeats(!0),a.css({transform:"scale("+v+")","transform-origin":"0 0"}),s.on("click touchend",".js-schk-zoom-in",function(){return o.actions.zoom.methods.zoom(1.5)}),s.on("click touchend",".js-schk-zoom-out",function(){return o.actions.zoom.methods.zoom(1/1.5)}),o.actions.pan.methods.enable(),f&&(g.model.attendees.length||g.model.event.uses_multiank||g.addAttendeeForm(),g.model.event.seatedTickets=o.data.cats||[]),g.recountSelectedTickets().done(function(){var e=s.find(".schk-modal__legend-wrap-mobile").outerWidth(!0),t=s.find(".schk-modal__legend").outerWidth(),i=s.find(".schk-modal__legend").children(".legend__cat"),r=navigator.userAgent.toLowerCase(),n=r.indexOf("chrome")<0&&0<r.indexOf("safari")&&r.substr(r.indexOf("version/")+"version/".length,3);if(n&&n<10){var o=0;g.T$.each(i,function(e,t){o+=$(t).outerWidth(!0)}),t=o}e-t<0&&(s.find(".schk-modal__advancer-arrow_right").show(),s.find(".schk-modal__arrow_right").show())}),g.recountSelectedPlaces(),g.obs.fireEvent("seatcheckLegendCreated",{renderTarget:t,iframeDocumentNode:i,iframe:r})})};if(f){var u=g.T$(r).parents(".twf-popup-container"),h=u.css("background-color");u.css("background-color","#f2f2f2");var m={filter:{d:{sector:p}}};d.css("padding-top",g.T$(r).height()/2-c.innerHeight()/2),g.loadSeatcheckData(m,function(e){d.remove(),u.css("background-color",h),o.setData(e).setElement(a.find(".schk-wrap").get(0)).appendOptions({eventregForm:g.$$("#eventreg_form").get(0),seats:{maxRescale:5}}).draw(),l(),o.i.restoreSelectedSeats()})}else l()},null,function(){var e=g.currentWindowNode.seatcheck;f||(e.actions.pan.methods.disable(),y.removeClass("schk-wrap_stretched"),y.addClass("schk-wrap_bounded"),k.removeAttr("style"),k.prepend(y),e.options.panels.right=0,e.drawer.rescaleSeats(!1)),e.tooltip.hideTooltip(!0),t||y.attr("tabindex","1").focus().blur().removeAttr("tabindex"),e.opening=!1})}},event_register.prototype.addAttendeeFormHandlers=function(e,t){var i=this,r=e.find(".js-section-re_selector, select.change-attendee-re");e.find(".remove-attendee").click(function(e){e.preventDefault(),i.removeAttendee(t)}),r.val(t.reId).change(function(e){t.reId=parseInt(r.val()),i.updateAttendeeCounts()}),this.model.event.uses_phone&&this.loadTPPhone().done(function(){return e.find("[data-type=phone] input").tpphone()}),this.model.event.uses_file_upload&&this.applyUploadcare()},event_register.prototype.prefillQuestions=function(r,e){var t=TWF2.Collections.H.each,n=TWF2.Collections.A.whereSingle;t(e,function(e,t){var i=n(r,function(e){return e.id==t||e.tag===t});i&&(i.value=e)})},event_register.prototype.addAttendeeForm=function(e,t){var i=this;void 0===t&&(t={});var r,n=this.addAttendee(e,t),o=(r=n,i.renderTemplate("_attendee_form",TWF2.cascade({},i.model,r)));return o.appendTo(this.$$(".b-attendees")),this.log("[FORM-view] added attendee form for re#"+e),this.addAttendeeFormHandlers(o,n),o.data("attendee",n),n.$block=o,this.model.event.uses_multiank&&this.updateAttendeeCounts(),this.obs.fireEvent("attendeeFormAdded",{reId:e,attendee:n,$form:o}),o},event_register.prototype.removeAttendee=function(e){var s=this;if(e.deletable){this.model.attendees.splice(e.num,1),e.$block&&e.$block.remove(),e.isSeated&&this.currentWindowNode.seatcheck.i.removeSeatSelectionByDatum(e.seatedInfo.place,!1);var a=0;this.T$.each(this.model.attendees,function(e,t){var i=s.$$(".b-attendees").find(".b-attendee-"+t.num),r=new RegExp("user_forms\\[\\d+\\]"),n=new RegExp("\\d+"),o=a+1;i.find("input,select,textarea").TWFiter(function(e){return e.attr("name",function(e,t){return t&&t.replace(r,"user_forms["+a+"]")})}),i.find(".b-registration__question-number").TWFiter(function(e){return e.text(function(e,t){return t.replace(n,o.toString())})}),i.removeClass("b-attendee-"+t.num).addClass("b-attendee-"+a),s.log("[attendee] renumerated "+t.num+" => "+a),t.num=a,t.displayNum=o,a++}),this.updateAttendeeCounts()}},event_register.prototype.addAttendeeForms=function(e){var i=this;e.preventDefault();var r,n=TWF2.Collections,o=this.mklog("addAttendeeForms");o("Mass adding forms for all selected tickets"),n.A.each(this.model.selectedTicketByCat,function(e,t){if(o("Adding %d tickets of cat %d",e,t),i.model.event.uses_places&&!n.A.whereSingle(i.model.event.tickets,function(e){return e.id==t}))o("Cat %d has PLACES, special treatment!",t),n.A.each(i.model.selectedSeatedTickets,function(e){return e.cat.id==t&&i.addAttendeeForm(+e.cat.id,{seatcheck:e})});else for(r=0;r<e;r++)i.addAttendeeForm(t)})},event_register.prototype.displayErrorOnRegForm=function(e){var t=this.$$(".b-registration__error");t.show().append(this.T$("<p>"+e+"</p>")),this.scrollToElement(t)},event_register.prototype.handleValidationErrors=function(e){var r=this,n=this,t=TWF2.Collections.H,o=TWF2.Collections.A,s=this.getText.bind(this),a=!0;t.each(e.validation_errors,function(e,t){if("+"===t||t.match(/user_forms\[\d+]\[\+]/i))o.each(e,function(e){return r.displayErrorOnRegForm(e)});else{a&&(r.displayErrorOnRegForm(s("Пожалуйста, проверьте правильность заполнения полей, выделенных красным.")),a=!1);var i=n.$$("div[data-formname='"+t+"']");r.T$.isArray(e)&&(e=e.join(". ")),i.find(".i-question-control").length?i.find(".i-question-control").addClass("b-input-block_status_error").append(n.renderTemplate("_errorBlock",{errorText:e})):i.addClass("error").append(TWF2.T$('<p class="text-error">'+e+"</p>"))}})},event_register.prototype.prepareRegistrationRequest=function(){var r=this,e=r.T$,t=r.$$("#eventreg_form"),i=TWF2.Collections.H,n=TWF2.Collections.A,o=function(e,t,i){r.model.formData[e+"["+t+"]"]=i};if(this.mklog("eventRegister:request")("Building request"),r.model.formData=r.reserializeHash(t.serializeArray()),e.extend(r.model.formData,this.settings.addFormData),r.model.formData.tickets=this.model.separateSelectedTickets,r.model.formData.locale=this.locale,r.model.formData.ga_cid=this.model.ga_cid,this.settings.prefill.aux.use_ticket_remind=this.settings.use_ticket_remind?1:0,this.settings.prefill&&this.settings.prefill.aux&&(i.each(this.settings.prefill.aux,function(e,t){return o("aux",t,e)}),"magick-search"==this.settings.prefill.aux.from)){var s=new RegExp("user_forms\\[\\d+\\]\\[mail\\]"),a=function(e){return e&&e.indexOf&&e.indexOf("@")<0&&(e+="@phone.timepad.ru"),e};i.each(i.where(r.model.formData,function(e,t){return t.match&&!!t.match(s)}),function(e,t){return r.model.formData[t]=a(e)}),r.model.formData.order_mail=a(r.model.formData.order_mail)}if(n.each(this.model.enteredPromocodes,function(e,t){return o("promocodes",t,e)}),this.model.enteredLegacyPromocode&&(this.model.formData.promocode=this.model.enteredLegacyPromocode),this.settings.forwardReferer){var d=document.referrer,c=!1;c="auto"===this.settings.forwardZeroReferer?this.settings.isInEventPage:!!this.settings.forwardZeroReferer,(d||c)&&(r.model.formData.referer=document.referrer)}this.settings.utmForward&&i.each(this.getUtms(),function(e,t){return r.model.formData[t]=e}),this.settings.forwardCookies&&i.each(this.getCookies(),function(e,t){return o("cookies",t,e)}),this.settings.prefill.utm&&i.each(this.settings.prefill.utm,function(e,t){return r.model.formData[t]=e}),this.model.partner&&(r.model.formData.r_p=this.model.partner),i.each(this.getTrackerEventData(),function(e,t){return o("stat_metadata",t,e)})},event_register.prototype.eventRegister=function(e){var n=this,o=this,s=this.getText.bind(this),a=(o.$$("#eventreg_form"),this.$$(".b-registration__error")),t=(TWF2.Collections.H,TWF2.Collections.A,this.prependConsumerHost("event/widget_register/"+o.model.event.id,{subdom:o.model.event.subdomain})),d=this.mklog("eventRegister");if(e.preventDefault(),this.prepareRegistrationRequest(),o.model.formData.promocode&&o.model.formData.promocode!==o.model.enteredLegacyPromocode&&-1===o.model.enteredPromocodes.indexOf(o.model.formData.promocode))return d("Detected legacy promocode, applying and stopping"),void this.handleApplyPromocode();this.toggleSubmitButton(!1);var c=o.startWaitingFor(function(){return n.toggleSubmitButton(!0)});d("Sending request %O to %s",o.model.formData,t),this.notifyTrackers("clicked button eventRegister",{event_value:this.model.selectedTickets.sum}),this.T$.post(t,o.model.formData).done(function(e){c(),d("Response recieved: %O",e);var t,i,r=e.result;a.empty().hide(),n.$$(".i-question-control").removeClass("b-input-block_status_error"),n.$$(".control-group").removeClass("error"),n.$$(".b-error-block").remove(),!r&&e.error&&(r="error"),"error"===r?(t=e.error,d("Error returned: %O",t),"validation"==t?n.handleValidationErrors(e):n.displayErrorOnRegForm(s("Произошла ошибка на стороне сервера: ")+t)):"success"===r&&(d("registration ok, processing routing"),i=e.status,o.model.order=e.order,"ok"===i?("charity"!==e.action&&(o.model.order.diploma_url=o.model.order.diploma_url+"?utm_campaign=tp_diploma_promo&utm_medium=tpd_widget&utm_source=tp_screen_reg_ok"),"charity"===e.action?o.route("charity"):o.model.order.has_tickets?o.route(o.settings.issueTickets?"tickets":"success"):o.route("success")):"pending"===i?o.route("pending"):"booked"==i&&o.route("pay"))}).fail(function(e,t,i){d("XHR error %d (%s): %s",e.status,t,i),"timeout"===t?n.displayErrorOnRegForm(s("Не удалось соединиться с сервером. Пожалуйста, попробуйте еще раз.")):500<=e.status&&e.status<600?n.displayErrorOnRegForm(s("Произошла ошибка на стороне сервера: ")+e.status+" ("+i+")"):n.displayErrorOnRegForm(s("Произошла неизвестная ошибка коммуникации: ")+i),c()})},event_register.prototype.recountSelectedTickets=function(){var t=this;this.log("[Recounts] recountSelectedTickets");var i=0,e=this.currentWindowNode.seatcheck,r=e?e.i.getSelectedData():[],n=this.T$.Deferred(),o=this.model.selectedTickets={count:0,sum:0},s=this.model.separateSelectedTickets=[],a=TWF2.Collections.A,d=this.getFormSelectedTickets();if(a.each(this.model.event.tickets,function(e){if(i=d[e.id]){o.count+=i,o.sum+=i*e.price;for(var t=0;t<i;++t)s.push({re_id:e.id})}}),a.each(r,function(e){o.count++,o.sum+=1*e.cache.price,s.push({re_id:e.catId,place_id:e.id})}),o.sum=Math.max(0,o.sum),this.model.selectedTicketByCat=d,this.obs.fireEvent("selectedTicketsRecounted",{}),this.model.event.uses_policies&&this.model.selectedTicketByCat.length){var c=this.$$(".selectedTicketsInfo");c.fadeTo("fast",.2),this.sendSituation().done(function(e){null!==e.final_price&&(t.log("[Recounts/situation] setting final price to "+e.final_price),o.sum_diff=e.final_price-o.sum,o.sum=e.final_price,o.sum=Math.max(0,o.sum))}).always(function(){c.fadeTo("fast",1),t.log("[Recounts/situation] resuming processing "),t.processSeletedTickets(o),n.resolve()})}else this.processSeletedTickets(o),n.resolve();return n},event_register.prototype.recountSelectedPlaces=function(){var i,r=this,e=this.currentWindowNode,t=this.getText.bind(this),n=e.seatcheck,o=n.i.getSelectedData().length,s=TWF2.Collections.A,a=n&&n.data?n.data.cats:[],d=this.T$(n.element).parents("body").find(".schk-scheme__proceed-btn");i=t(this.plural(o,"%s билет","%s билета","%s билетов"),[o]);var c={promocodes:s.toHash(this.model.enteredPromocodes,function(e,t){return{k:t,v:e}}),selectedTicketCategories:s.map(this.model.selectedTicketByCat,function(e,t){var i=s.whereSingle(a,function(e){return e.id==t});if(i)return{price:i.price,category_id:t,category_name:i.name,tickets_count:e}}),selectedTickets:s.map(this.model.separateSelectedTickets,function(t){var e=s.whereSingle(a,function(e){return e.id==t.re_id});if(e)return{price:e.price,category_id:t.re_id,category_name:e.name,meta:t.meta}})},l=this.prependConsumerHost("event/widget_run_policies/"+this.model.event.id,{subdom:this.model.event.subdomain});if(this.T$.post(l,this.$reserializeRequest({situation:c})).done(function(e){var t=0<e.final_price?" на сумму "+r.formatSum(e.final_price):"";r.T$(n.element).parents("body").find(".schk-scheme__selected-num").text(i+t)}),0<o){d.show();var u=this.model.event.uses_multireg?"Изменить выбор мест":"Выбрать другое место";this.$$(".js-schk-wrap__cover-btn").text(t(u))}else{u=this.model.event.uses_multireg?"Выберите места на схеме зала":"Выберите место на схеме зала";this.$$(".js-schk-wrap__cover-btn").text(t(u)),d.hide()}},event_register.prototype.handleTicketsSelection=function(){var e=this.currentWindowNode.seatcheck,t=this.model.event;!t.uses_multireg&&t.has_active_places&&(e.i.clearSeatsSelection(),this.updatePlacesList(),this.recountSelectedPlaces()),this.recountSelectedTickets()},event_register.prototype.sendSituation=function(){var i=this,r=this,n=this.T$.Deferred(),o=TWF2.Collections.A,s=this.mklog("sendSituation"),e=this.currentWindowNode.seatcheck,a=e&&e.data?e.data.cats:[],d={promocodes:o.toHash(this.model.enteredPromocodes,function(e,t){return{k:t,v:e}}),selectedTicketCategories:o.map(this.model.selectedTicketByCat,function(e,t){var i=o.whereSingle(r.model.event.tickets,function(e){return e.id==t})||o.whereSingle(a,function(e){return e.id==t});return{price:i.price,category_id:t,category_name:i.name,tickets_count:e}}),selectedTickets:o.map(this.model.separateSelectedTickets,function(t){var e=o.whereSingle(r.model.event.tickets,function(e){return e.id==t.re_id})||o.whereSingle(a,function(e){return e.id==t.re_id});return{price:e.price,category_id:t.re_id,category_name:e.name,meta:t.meta}}),buyerEmail:this.model.event.policy_features.email&&this.getQuestionValue("order_mail")||this.getQuestionValue("mail",0)};return s("sending situation for policy run: %O",d),this.abortPreviousXhr("widget_run_policies",function(){var e=i.prependConsumerHost("event/widget_run_policies/"+r.model.event.id,{subdom:r.model.event.subdomain}),t=i.T$.post(e,r.$reserializeRequest({situation:d}));return t.done(function(e){s("response recieved: %O",e),(i.model.policyResult=e).effects?n.resolve(e):n.fail()}).fail(function(){return n.fail()}),t}),n},event_register.prototype.getAppliedPolicies=function(){return this.model.policyResult&&this.model.policyResult.applied_policies&&this.model.policyResult.applied_policies.length?this.model.policyResult.applied_policies:[]},event_register.prototype.getFormSelectedTickets=function(e){void 0===e&&(e=["checkbox","seatcheck","count","hidden"]);var t=[],i=TWF2.Collections.A,r=i.toFlags(e);i.each(this.model.event.tickets,function(e){return t[e.id]=0}),r.count&&this.$$("select.b-reg-table__select").TWFiter(function(e){return t[e.data("reid")]=parseInt(e.val())}),r.checkbox&&this.$$("input.b-reg-table__select:checked").TWFiter(function(e){return t[e.data("reid")]=1}),r.hidden&&this.$$("input.b-reg-table__hidden").TWFiter(function(e){return t[e.data("reid")]=1}),r.count&&this.$$(".js-tickets_count_input").TWFiter(function(e){return t[e.data("reid")]=parseInt(e.val())});var n=this.currentWindowNode.seatcheck,o=n?n.i.getSelectedData():[],s=this.model.event.seatedTickets;return i.each(s,function(e){return t[e.id]=0}),r.seatcheck&&i.each(o,function(e){return t[e.catId]++}),t},event_register.prototype.setFormSelectedTickets=function(e,t){var r=this;void 0===t&&(t=["checkbox","count","hidden"]);var i=TWF2.Collections.A,n=i.toFlags(t),o=this.mklog("setFormSelectedTickets");o("Processing selectors of types %s",t.join("|")),o("Resetting selectors to zero"),this.clearFormSelectedTickets(t),null!==e&&(o("Setting ticket counts to %O",e),i.each(e,function(e,t){var i="";t&&null!==e&&(i="[data-reid="+t+"]"),n.checkbox&&(o("Setting checkbox of %d to %d",t,e),r.$$("input.b-reg-table__select"+i+":checked").attr("checked",0<e)),n.count&&(o("Setting select or plusminus of %d to %d",t,e),r.$$("select.b-reg-table__select"+i).val(e),r.$$(".js-tickets_count_input"+i).val(e)),n.hidden&&(o("Setting input type hidden of %d to %d",t,e),r.$$("input.b-reg-table__hidden"+i).val(e))}))},event_register.prototype.clearFormSelectedTickets=function(e){void 0===e&&(e=["checkbox","count","hidden"]);var t=TWF2.Collections.A.toFlags(e),i=this.mklog("clearFormSelectedTickets");t.checkbox&&(i("Clearing checkboxes"),this.$$("input.b-reg-table__select:checked").attr("checked",!1)),t.count&&(i("Clearing selects and plusminuses"),this.$$("select.b-reg-table__select").val(0),this.$$(".js-tickets_count_input").val(0)),t.hidden&&(i("Clearing input type hidden"),this.$$("input.b-reg-table__hidden").val(0))},event_register.prototype.disableFormSelectedTickets=function(){this.$$(".b-reg-table__plusminus, .b-reg-table select.b-reg-table__select").hide(),this.$$(".multiank_counter").show()},event_register.prototype.updateAttendeeCounts=function(){var i=this;this.log("[Recounts] updateAttendeeCounts"),this.$$(".multiank_counter").text(0);var t=[];TWF2.Collections.A.each(this.model.attendees,function(e){return t[e.reId]=t[e.reId]+1||1}),TWF2.Collections.A.each(t,function(e,t){i.$$("#rei_cont_"+t).find(".multiank_counter").text(e)}),this.setFormSelectedTickets(t),this.recountSelectedTickets()},event_register.prototype.updateTicketsSelectionInterface=function(){var e=this;this.log("[Recounts] updateTicketsSelectionInterface");var t=this.$$(".section-submit, .section-ank"),i=this.$$(".section-multiankadd"),r=!!this.model.attendees.length,n=this.model.event.uses_multiank,o=!(!this.model.selectedTickets||!this.model.selectedTickets.count),s=n&&this.settings.multiankSettings.initialSelects;if(this.settings.hideFormsWhenNoTickets&&(n&&r||!n&&o?(this.log("[tsi] showing regform"),t.show()):(this.log("[tsi] hiding regform"),t.hide())),s&&(r||this.flags.multiankSelectsReplaced||(this.log("[tsi] showing mass attendee adder"),i.show().removeClass("hide")),r&&(this.log("[tsi] hiding mass attendee adder"),i.hide()),r&&!this.flags.multiankSelectsReplaced&&(this.log("[tsi] disabling mass attendee selects"),this.disableFormSelectedTickets(),this.$$(".b-add-attendee").show(),this.flags.multiankSelectsReplaced=!0)),n&&(!s||this.flags.multiankSelectsReplaced)){this.log("[tsi] setting states for add-re selects...");var a,d,c,l,u=this.$$(".add-attendee"),h=this.T$;this.model.event.tickets.forEach(function(i){a=TWF2.Collections.A.arrayCount(e.model.attendees,function(e){return e.reId==i.id}),c=e.$$(".add-attendee-re").find(".attendee-re-option-"+i.id),d=e.$$(".change-attendee-re").find(".attendee-re-option-"+i.id).filter(function(e,t){return h(t).parent().val()!=i.id}).add(c),i.max&&a>=i.max?(e.log("[tsi] switching off availability of re#"+i.id),d.attr("disabled","disabled")):(e.log("[tsi] switching on availability of re#"+i.id),d.removeAttr("disabled").removeAttr("selected"))}),(l=this.$$(".add-attendee-re option").filter(function(e,t){return!h(t).attr("disabled")})).length?(this.log("[tsi] switching on adding more attendees"),l.first().attr("selected","selected"),u.removeClass("disabled")):(this.log("[tsi] switching off adding more attendees"),u.addClass("disabled"))}},event_register.prototype.toggleSubmitButton=function(e){var t=this.$$(".b-pro-wiget__reg-button"),i=this.$$(".js-pro-widget-terms-popup");e?(t.removeClass("disabled").removeAttr("disabled"),i.addClass("b-pro-widget__terms-popup_hidden")):t.addClass("disabled").attr("disabled","disabled")},event_register.prototype.getTotalText=function(e){var t,i=this.getText.bind(this);return this.model.event.uses_ticket_choice?e.count?(t=i("Вы выбрали")+" ",t+=e.count+" ",t+=this.plural(e.count,i("билет"),i("билета"),i("билетов")),e.sum&&(t+=" "+i("на сумму")+" "+this.formatSum(e.sum))):t=this.model.event.uses_multireg?i("Вы не выбрали ни одного билета!"):i("Вы не выбрали билет!"):t=e&&e.sum?i("Стоимость билета — ")+this.formatSum(e.sum):i("Регистрация бесплатна."),e&&e.count&&e.sum_diff&&(e.sum_diff<0?t+=" ("+i("скидка")+" "+this.formatSum(-e.sum_diff)+")":0<e.sum_diff&&(t+=" ("+i("включая сервисный сбор")+" "+this.formatSum(e.sum_diff)+")")),t},event_register.prototype.processSeletedTickets=function(e){var t,i=this.$$(".selectedTicketsInfo");e=e||this.model.selectedTickets;if(t=this.getTotalText(e),this.model.event.uses_ticket_choice&&(e.count?i.removeClass("error"):i.addClass("error")),i.text(t),this.model.event.uses_policies){var r=i.parents(".b-reg-table__row"),n="b-reg-table__row_type_promo";this.$$(".policyResultRow").remove(),this.model.policyResult&&this.model.policyResult.applied_policies.length?r.addClass(n).before(this.renderTemplate("_policyResult",this.model)):r.removeClass(n)}this.updateTicketsSelectionInterface(),this.changeSubmit(e)},event_register.prototype.changeSubmit=function(e){var t=this.getText.bind(this),i=this.$$(".b-pro-wiget__reg-button"),r=this.settings.mainFormButtonSettings.texts,n=this.$$(".js-acquirings"),o=this.$$('input[name="accepted_terms"]');e.count?(this.toggleSubmitButton(!0),this.model.event.uses_multiank&&!this.flags.multiankSelectsReplaced?i.text(t(r.proceed)):e.sum?i.text(t(r.buy)+" "+(1<e.count?t(r.items[1]):t(r.items[0]))):i.text(t(r.register)),e.sum?n.show():n.hide(),o.is(":visible")&&!o.is(":checked")&&this.toggleSubmitButton(!1)):(this.toggleSubmitButton(!1),i.text(t(r.atleast))),this.settings.mainFormButtonSettings.staticText&&i.text(t(this.settings.mainFormButtonSettings.staticText))},event_register.prototype.reloadEvent=function(e){var t={event:this.model.event.id,promocode:this.model.enteredLegacyPromocode};this.settings.locale&&(t.locale=this.settings.locale),this.getEvent(t,e)},event_register.prototype.setUpQuestions=function(r){var t=this,e=this.T$;e.each(this.defaultQuestions.slice(0).reverse(),function(e,t){r.questions.unshift(t)}),r.master_questions=[],e.each(r.questions,function(e,i){i[i.type]=!0,i.id&&!i.formname&&(i.formname="question"+i.id),i.multiank_master&&(i.vars&&(i.vars_unfold=t.$unfold(i.vars,function(e,t){return{text:t,num:e+1,aname:i.formname+"-"+e}})),r.master_questions.push(i)),i.description&&(i.description=i.meta.comment=TWF2.Util.S.nl2br(i.description)),i.meta.dadata&&t.loadDadata()}),r.has_master_questions=!!r.master_questions.length},event_register.prototype.initalizeAnk=function(){var e=this.model.event,t=this.settings,i=null,r=this.mklog("Init ank");r("(Re)initializing regform"),e.tickets.length&&(i=e.tickets[0].id),this.obs.fireEvent("preInitializeAnk",{e:e,reId:i},this),e.has_master_questions&&this.settings.prefill&&(r("Prefilling master questions"),t.prefill.order&&this.prefillQuestions(e.master_questions,t.prefill.order)),!i||!t.multiankSettings.addFirstAttendee&&e.uses_multiank||(r("Adding first attendee"),this.addAttendee(i)),this.flags.ankInitialized=!0},event_register.prototype.postprocessEventModel=function(s){var a=this,d=this.mklog("postprocessEventModel"),m=TWF2.Collections.A,e=TWF2.Collections.H,t=(TWF2.Util,this.getText.bind(this)),o=this;d("Begin"),o.model.attendees=[];var i=[],r=[];s.has_promocode&&(m.each(s.tickets,function(e){e.has_promocode?i.push(e):r.push(e)}),s.tickets=i.concat(r)),s.min_price=1/0,s.has_promocode=s.has_promocode||s.policy_features.promocode;var c=s.tickets.length,l=i.length;if(m.each(s.tickets,function(e,t){if(d("Postprocessing ticket '%s' (%d)",e.name,e.id),e.h_price=a.formatSum(e.price),s.min_price=Math.min(e.price,s.min_price),s.max_price=Math.max(e.price,s.max_price),s.has_active_places||(1==c&&e.min<=1?(d("Forcing selection of %s #%d (the only choice)",e.name,e.id),e.min=1,e.force_check=!0):t||s.uses_multireg||(d("Forcing selection of %s #%d (default choice)",e.name,e.id),e.force_check=!0)),e.has_promocode&&1==l&&(d("Forcing selection of %s #%d (promocode autoselect)",e.name,e.id),e.force_check=!0),e.available||(e.min=e.max=0),e.ticket_choices=[],a.settings.use_plusminus)1==e.min&&(e.min=0);else for(var i=e.min;i<=e.max;i++)e.ticket_choices.push({val:i,selected:i==e.min&&e.force_check});if(e.comment&&(e.comment=TWF2.Util.S.nl2br(e.comment)),s.show_text_tickets_remain)if(0<e.tickets_left){var r=o.plural(e.tickets_left,"Остался ","Осталось ","Осталось "),n=o.plural(e.tickets_left," билет"," билета"," билетов");e.text_tickets_remain=r+e.tickets_left+n}else e.tickets_left||"ok"==e.status?e.tickets_left||"ok"!=e.status||(e.text_tickets_remain="Количество билетов не ограничено"):e.text_tickets_remain="Билеты закончились";e.default_count=e.force_check?1:0}),s.has_active_regular_tickets=!!s.tickets.length,o.model.enteredLegacyPromocode&&!s.promocode_ok&&(s.promocode_wrong=!0),s.recurring_events&&s.recurring_events.length){var u=this.context.loader.getSandbox("momentjs").moment,n={};s.recurring_events_by_day=[],m.each(s.recurring_events,function(e){e.moment=u.parseZone(e.date_iso8601),e.ymd=+e.moment.format("YYYYMMDD"),e.tickets_left_h=e.tickets_left+" "+a.plural(e.tickets_left,t("билет"),t("билета"),t("билетов")),e.min_price_h=a.formatSum(e.min_price),n[e.timestamp]=n[e.timestamp]||[],(!e.unavaliable||a.settings.recurringShowClosed)&&n[e.timestamp].push(e)}),s.has_recurring_events_by_day=!!s.recurring_events.length;var h,p=!0,g=null;if(d("Restructuring recurring_events_by_day"),e.each(n,function(e){if(e.length){var t=e[0],i=+t.moment.format("DDD"),r=null!==g?i-g:0,n=u(h||t.moment);for(d("Processing %s (#%d), %d days since %d",t.date_day,i,r,g),p=p&&1===e.length;a.settings.recurringShowEmptyIntervals&&1<r;){r--;var o=n.add(1,"days");d("Adding empty spanning day %s",o.format("ll")),s.recurring_events_by_day.push({moment:u(o),ymd:+o.format("YYYYMMDD"),day:o.format("LL").replace(/\d\d\d\d\s*(.\.)?/,""),day_of_week:o.format("dddd"),events:[],month:o.format("MMMM"),year:+o.format("YYYY")})}s.recurring_events_by_day.push({moment:u(t.moment),ymd:+t.ymd,day:t.date_day,day_of_week:t.day_of_week,events:e,month:t.month_number,year:t.year}),g=i,h=t.moment}}),"vertical-days"===this.settings.recurringDatesMode){d("Building vertical-days grid");var f={},v={is_header:!0,cells:[]};m.each(s.recurring_events_by_day,function(e){d("Adding header for %s",e.ymd),v.cells.push({ymd:e.ymd,is_header:!0,day_of_week:e.moment.format("dd"),day_month:e.day,is_weekend:6<=e.moment.format("E")})}),m.each(s.recurring_events,function(e){var t=e.moment.format("HH:mm"),i=+e.moment.format("m")+60*e.moment.format("H");d("Collecting event with time %s (%s second of day)",t,i),f[i]=f[i]||[],f[i].push(e)}),d("Events by time = %O",f);var _=e.mapToArray(f,function(e,t){return t}).sort(function(e,t){return e-t});if(d("Times list = %O",_),s.recurring_events_grid=[v],m.each(_,function(i){var r={cells:[]};m.each(v.cells,function(t){var e={events:m.where(f[i],function(e){return e.ymd==t.ymd})};r.cells.push(e)}),s.recurring_events_grid.push(r)}),this.settings.recurringVerticalCompress){var k=function(){var h=a.mklog("tsrow compression"),e=m.copy(s.recurring_events_grid);m.each(e,function(a,d){if(!a.is_header){var c=e[d-1],l=e[d+1],u=function(e){return e?m.arrayCount(e.cells,function(e){return!!e.events}):0};c.is_header&&(c=null),m.each(a.cells,function(e,t){h("Core at %d,%d",d,t);var i=[c,a,l],r=m.copy(i).sort(function(e,t){return u(t)-u(e)})[0],n=r&&r.cells&&r.cells[t];if(n&&!n.events.length){h("Core gravity center empty, trying to attract");var o=m.map(m.where(i,function(e){return e&&e.cells}),function(e){return e.cells[t]}),s=m.whereSingle(o,function(e){return e.events.length});s&&(h("Found cell to attract"),n.events=s.events,s.events=[])}})}}),s.recurring_events_grid=m.where(e,function(e){return e.is_header||0<m.arrayCount(e.cells,function(e){return e.events&&e.events.length})})};d("Will compress timeslots %d times...",this.settings.recurringVerticalCompress);for(var y=0;y<this.settings.recurringVerticalCompress;y++)d("Compressor run %d",y+1),k()}}"auto"===this.settings.recurringDatesMode&&p&&(this.model.squishRecurringDates=!0)}o.setUpQuestions(s),s.uses_phone=!!TWF2.Collections.A.arrayCount(o.model.event.questions,function(e){return"phone"==e.type}),d("Processed")},event_register.prototype.getEventCacheKey=function(e){return TWF2.Collections.H.mapToArray(e,function(e,t){return t+"_"+e}).sort().join("__")},event_register.prototype.loadEventModel=function(e,n,o){var s,a=this,t={url:this.prependConsumerHost("api/event_model"),method:"GET",crossDomain:!0,dataType:"jsonp",data:e},d=this.mklog("MODEL"),c=this,i=c.T$,l=this.getEventCacheKey(e),r=(TWF2.microguid(4),function(e,t){if(void 0===t&&(t=!0),!(s=e)||!s.id||s.error){var i="unknown";return s&&("entity_does_not_exist"==s.error?i="404":"not_authorized"==s.error&&(i="403")),d("error %O!",s),void(o&&o(i))}a.eventCache[l+"_u"]=TWF2.ecopy(s),a.resetEventModel(),c.model.event=s,a.handlePromocodeNote(),a.switchLocale(a.settings.locale||s.locale);var r=[];s.is_recurring&&(r=a.lazyPackages.postprocessRecurringEvent),d("Additional packages to load: %O",r),a.context.loadPackages(r,function(){d("Additional packages ready"),t&&a.postprocessEventModel(s),a.flags.ankInitialized||a.initalizeAnk(),a.loadOrgTrackers(),d("Loaded"),t&&(d("Saving postprocessed cache"),a.eventCache[l]=TWF2.ecopy(a.model.event)),n(s)})});this.eventCache[l]?(d("[P] Event postprocessed model cache hit"),r(this.eventCache[l],!1)):this.eventCache[l+"_u"]?(d("[ ] Event model cache hit"),r(this.eventCache[l+"_u"])):(d("Event model requested"),i.ajax(t).done(function(e){d("response recieved"),r(e)}))},event_register.prototype.getEvent=function(e,i){var r=this,n=this,o=TWF2.cascade({response_type:"jsonp"},e);o.event?this.waitFor(function(t){r.loadEventModel(o,function(e){t(),i(e)},function(e){t(),n.route("widget_error",{type:e})})},{caption:"Загрузка информации, пожалуйста подождите"}):n.route("widget_error",{type:"400"})},event_register.prototype.getAttendeeCount=function(){return this.model.attendees.reduce(function(e,t){return void 0!==t?e+1:e},0)},event_register.prototype.getHumanPlace=function(t){var i,e=this.currentWindowNode.seatcheck.data.tooltip,r=[],n=TWF2.Collections.A,o=this.getText.bind(this);return n.each(e,function(e){void 0!==(i=t[e.key])&&r.push(o(e.name)+" "+i)}),r.join(" ")},event_register.prototype.addAttendee=function(e,t){var o=this;void 0===t&&(t={});var s={num:this.getAttendeeCount(),questionsSet:[],displayNum:this.getAttendeeCount()+1,isFirst:!this.getAttendeeCount()&&this.settings.multiankSettings.distinguishFirstAttendee,reId:e},i=this.T$,a=this.mklog("FORM-model");if(a("adding attendee #%d model for re#%d",s.num,e),this.obs.fireEvent("preAddAttendee",{additionalInfo:t,reId:e,attendee:s},this),this.model.event.uses_places){var r=t.seatcheck;r&&(a("Adding form for SEATED category!"),s.isSeated=!0,s.seatedInfo=r)}return i.each(this.model.event.questions,function(e,t){a("adding attendee model question %d",e);var i,r,n=TWF2.ecopy(t);r=n.multiank_master?function(e){return e}:function(e){return"user_forms["+s.num+"]["+e+"]"},n[t.type]=!0,i=t.formname,t.id&&!t.formname&&(i="question"+t.id),n.upload&&(i="uc-"+i),n.formname=r(i),t.uses_phone_verify&&(n.phone_verify_formname=r(i+"__pvcode")),t.vars&&(n.vars_unfold=o.$unfold(t.vars,function(e,t){return{text:t,num:e+1,aname:r(i+"-"+e)}})),n.multiank_master||s.questionsSet.push(n)}),this.settings.prefill&&this.settings.prefill.attendees&&(a("looking for attendee #%d prefill data",s.num),this.settings.prefill.attendees[s.num]&&(a("prefilling attendee #%d prefill data",s.num),this.prefillQuestions(s.questionsSet,this.settings.prefill.attendees[s.num]))),s.deletable=!s.isFirst||s.isSeated,this.model.attendees.push(s),s},event_register.prototype.getEmbedderUrl=function(e){e||(e=window);var t=e.document.location.toString(),i=this.mklog("getEmbedderUrl");if(i("document url determined as %s",t),e.frameElement){try{if(i("Trying to go up"),e.top&&e.top.document)return i("Attempting to up"),this.getEmbedderUrl(e.top)}catch(e){i("Sad, can't go up: %s",e)}e.document.referrer&&(i("We are in iframe, using its referer %s"),t=e.document.referrer)}return t},event_register.prototype.getUtms=function(e){void 0===e&&(e=document.location.search);var t=TWF2.Collections.H,i=TWF2.Util,r=TWF2.Util.EnsureType,n=TWF2.extend,o=i.QueryString.fromUrl(e).fragments,s=r.H(this.settings.prefill.utm);return t.where(n(o,s),function(e,t){return!!t.match("^utm_")})},event_register.prototype.getCookies=function(){var i=this.settings.forwardCookies;return!i&&i.length?{}:TWF2.Collections.H.where(TWF2.Util.Cookies.getCookies(),function(e,t){return 0<=i.indexOf(t)})},event_register.prototype.getTrackerEventData=function(){var i=this.getUtms(),e={event_id:1*this.model.event.id||0,org_id:1*this.model.event.org||0,event_cats:this.model.event.categories?this.model.event.categories.join(","):"",reg_count:this.model.event.tickets?1*this.model.event.tickets.length:0,questions_count:1*this.model.event.questions_count||0,max_price:1*this.model.event.max_price||0,from:"widget",widget_mode:"default",widget_id:null,widget_consumer_url:document.location.href,use_multireg:!!this.model.event.uses_multireg,widget_use_multiank:!!this.model.event.uses_multiank,utms:i};return this.settings.addFormData&&TWF2.Collections.H.each(this.settings.addFormData,function(e,t){return t.match("^utm_")&&(i[t]=e)}),("button"==this.settings.initialRoute||this.settings.popup.triggerSelector)&&(e.widget_mode="popup"),this.model.isInTimepad?e.from="isInTimepad":this.settings.iframe.useVkScroll?e.widget_mode="vk":this.settings.isInEventListWidget&&(e.widget_mode="event_list_widget"),this.settings.isWidgetBare&&(e.widget_mode="bare_widget"),this.settings.isWidgetFacebook&&(e.widget_mode="fb_widget"),this.customizationId&&(e.widget_id=1*this.customizationId),e},event_register.prototype.loadOrgTrackers=function(){var r=this,e=TWF2.Collections.H,t=TWF2.Util,n=(t.EnsureType,this.mklog("loadOrgTrackers")),o=(TWF2.cascade,0);this.settings.load_org_trackers?this.model.event&&this.model.event.org_trackers?(e.each(t.EnsureType.H(this.model.event.org_trackers),function(e,t){var i="org_"+t;e&&"string"==typeof e&&!r.settings.trackers[i]?(r.settings.trackers[i]={enable:!0,trackerName:"tpw_org_"+t,trackerId:e,isOrg:!0},n("Added org tracker (%s), id %s",t,e),o++):n("Ignoring org tracker (%s) with an empty id",t)}),o||n("No trackers added")):n("No org trackers configured"):n("Loading of org trackers is disabled")},event_register.prototype.notifyTrackers=function(r,n){var t=this;void 0===n&&(n={});var i=this.settings.trackers,o=function(e){return i[e]&&i[e].enable&&(!n.selective_trackers||0<=n.selective_trackers.indexOf(e))},e=function(e,t){return o(e)&&t(i[e])},s=TWF2.Collections.H,a=this.getTrackerEventData(),d=this.mklog("notifyTrackers"),c=function(e){return"[TimePad] "+e},l={event_id:a.event_id,widget_mode:a.widget_mode},u=n.event_value?+n.event_value:0;d("Tracking %s",r),e("cube",function(e){d("Tracked Cube: %s",r),t.sendEventToCube(r,a,e.sig)}),e("ref",function(e){d("Tracked TPref: %s",r),t.sendEventToTracker(r,a)}),e("org_facebook",function(e){d("Tracked Facebook: %s",r),window.fbq&&window.fbq("trackCustom",c(r))}),e("org_vkontakte",function(e){d("Tracked Vkontakte: %s",r),window.VK&&window.VK.Retargeting&&window.VK.Retargeting.Event(c(r))}),o("org_ga")&&this.gaLoad(function(e,t){try{e(t.trackerName+".send",{hitType:"event",eventCategory:"user",eventAction:c(r),eventLabel:(i=l,s.mapToArray(i,function(e,t){return t+":"+e}).join(";")),eventValue:u,nonInteraction:+!!n.none_interactive}),d("Tracked GA: %s",r)}catch(e){d("Failed tracking GA: %s, %s",r,e)}var i},"org_ga"),o("org_metrika")&&this.metrikaLoad(function(e){try{e.reachGoal(c(r),l),d("Tracked Metrica: %s",r)}catch(e){d("Failed tracking Metrica: %s, %s",r,e)}},"org_metrika")},event_register.prototype.sendPayRequest=function(e){e.preventDefault();var t=this.getText.bind(this),i=e.target,r=this.$$(".no-contract__notice"),n={url:this.prependConsumerHost("/org/send_ticket_request/"+this.model.order.registration.id,{subdom:this.model.event.subdomain}),type:"GET",dataType:"jsonp"};this.T$(i).attr("disabled","disabled").addClass("disabled"),this.T$.ajax(n).done(function(e){"ok"==e.send_status?r.html(t("Заявка отправлена. В ближайшее время организаторы свяжутся с вами.")):e.error&&r.html(t("Что-то пошло не так. Попробуйте отправить заявку позже."))})},event_register.prototype.showTermsAcceptPopup=function(e){var t=this.$$(".js-pro-widget-terms-popup"),i=this.$$("#eventreg_submit"),r=this.$$('input[name="accepted_terms"]');i.hasClass("disabled")&&!r.is(":checked")&&t.removeClass("b-pro-widget__terms-popup_hidden")},event_register.prototype.getQuestionValue=function(e,t){void 0===t&&(t=null);var i=e;return null!==t&&(i="user_forms["+t+"]["+e+"]"),this.$$('[name="'+i+'"]').val()},event_register.prototype.handlePhoneRequiresVerificationChange=function(e){var t=this.mklog("sendSMSVerify"),i=this.T$(e.target),r=i.data("phone-verify"),n=this.$$("[data-phone-verify='"+r+"'].js-verify-btn"),o=i.val().replace(/[^\d]/,"").length,s=this.$$("[data-phone-verify='"+r+"'].js-verify-desc"),a=this.$$("[data-phone-verify='"+r+"'].js-verify-block-hideble");t("Len of phone is: ",o),i.removeClass("phone_valid phone_invalid"),0<o?(t("Enabling verify interface"),a.show(),s.hide(),n.removeAttr("disabled")):(t("Disabling verify interface"),a.hide(),s.hide().filter(".js-verify-desc_nophone").show(),n.attr("disabled","disabled"))},event_register.prototype.handlePhoneVerifySend=function(e){var i=this,r=this.mklog("sendSMSVerify"),t=this.T$(e.target).data("phone-verify"),n=this.$$("[name='"+t+"']"),o=this.$$("[data-phone-verify='"+t+"'].js-verify-code"),s=this.$$("[data-phone-verify='"+t+"'].js-verify-btn"),a=this.$$("[data-phone-verify='"+t+"'].js-verify-label"),d=this.$$("[data-phone-verify='"+t+"'].js-verify-desc"),c=this.$$("[data-phone-verify='"+t+"'].js-verify-info"),l=this.$$("[data-phone-verify='"+t+"'].js-verify-desc_preresend").find(".js-verify-timer"),u=this.$$("[data-phone-verify='"+t+"'].js-verify-info-danger").hide(),h={event:this.model.event.id,locale:this.locale,phone:n.val()},m={url:this.prependConsumerHost("api/widget_verify_phone_send"),method:"POST",crossDomain:!0,data:h};this.abortPreviousXhr("widget_verify_phone_send",function(){r("Requesting sms code for %s",h.phone);var e=i.T$.ajax(m);return e.done(function(e){if(r("response recieved: %O",e),"success"===e.result)c.hide().filter(".js-verify-info-warning").show(),a.hide().not(".js-verify-label_nophone").show(),d.hide().filter(".js-verify-desc_preresend").show(),s.hide(),o.show(),function(e){var r,n=i.mklog("checkSMSVerify"),o=parseInt(e);n("Next code try timestams is ",o);var t=function(){var e=1e3*o-Date.now(),t=Math.floor(e/1e3%60),i=Math.floor(e/1e3/60%60);l.text(("0"+i).slice(-2)+":"+("0"+t).slice(-2)),t<=0&&i<=0&&(n("Can resend code now"),d.hide().filter(".js-verify-desc_resend").show(),clearInterval(r))};t(),r=setInterval(t,500)}(""+e.next_try),o.data("code-len",e.code_len),r("Code len is: ",e.code_len);else{var t="";t="verification_throttled"==e.error?"Не удалось отправить код: слишком мало времени прошло с отправки предидущего кода. Следующая попытка будет доступна через "+e.timeout+" секунд ("+e.time_left+").":'Не удалось отправить код. Ошибка "'+e.error+'"',u.text(t).show()}}).fail(function(){return u.text("Не удалось соединиться с сервером, попробуйте еще раз").show()}),e}),e.preventDefault()},event_register.prototype.handlePhoneVerifyInput=function(e){var t=this,i=this.mklog("checkSMSVerify"),r=this.T$(e.target).data("phone-verify"),n=this.$$("[name='"+r+"']"),o=this.T$(e.target),s=o.val(),a=+o.data("code-len"),d=this.$$("[data-phone-verify='"+r+"'].js-verify-desc"),c=this.$$("[data-phone-verify='"+r+"'].js-verify-info");if(!a)return i("No idea what is code_len, no smartass actions"),void n.addClass("phone_invalid");if(s.length===a){i("Verifying code");var l={event:this.model.event.id,phone:n.val(),vcode:s},u={url:this.prependConsumerHost("api/widget_verify_phone_check"),method:"POST",crossDomain:!0,data:l};this.abortPreviousXhr("widget_verify_phone_check",function(){i("Checking sms code %s for %s",s,l.phone);var e=t.T$.ajax(u);return e.done(function(e){i("response recieved: %O",e),e.code_valid?(i("Phone is valid!"),c.hide().filter(".js-verify-info-success").show(),d.hide(),n.addClass("phone_valid")):(i("Phone is not valid!"),n.addClass("phone_invalid"))}),e})}else i("Input code length is %s, expecting %s. Ignoring for now",s.length,a)},event_register.prototype.handleShowVKPay=function(e){e.preventDefault(),this.showVKPay()},event_register.prototype.showVKPay=function(){var e=this,t=this.mklog("showVKPay"),i=window.VK,r=this.model.order.vk_pay_params;t("Trying to made VKPay payment");try{i.init(function(){t("Success of VK.init"),e.waitFor(function(e){i.callMethod("openExternalApp","vkpay",r),t("'openExternalApp' called with: ",r),setTimeout(e,3e4)},{caption:"Открываем окно оплаты VKPay..."})})}catch(e){this.log("VKPay payment fails in the very beginning: "+e)}},event_register.prototype.handleCharity=function(e,t){e.preventDefault();var i=this.T$(e.target),r=this.$$(".js-charity-info"),n=this.$$(".js-charity-show"),o=this.$$(".js-charity-hide"),s=this.$$(".js-charity-amount"),a=function(){n.hide(),o.show(),r.show()};"checkbox"===t?i.is(":checked")?(a(),s.removeAttr("disabled")):s.attr("disabled","disabled"):"show"===t?a():(n.show(),o.hide(),r.hide())},event_register.prototype.checkVKPay=function(){return window.VK&&this.model.prefill&&this.model.prefill.aux&&this.model.prefill.aux.vk_installation_id&&this.model.event&&this.model.event.uses_vk_pay},event_register.prototype.formatSum=function(e){var t=this.getText.bind(this),i=t("%s руб."),r=t("бесплатно");return this.model.event&&this.model.event.currency_formatter&&(i=this.model.event.currency_formatter),e?i.replace("%s",e):r},event_register}(TWF2.RichWidget);WidgetPrototypes.event_register=event_register}(WidgetPrototypes=TWF2.WidgetPrototypes||(TWF2.WidgetPrototypes={}))}(TWF2||(TWF2={})),window.TWF2.WidgetPrototypes.event_register.prototype._tpls={},window.TWF2.WidgetPrototypes.event_register.prototype._css="",window.TWF2.WidgetPrototypes.event_register.prototype.extCss="https://timepad.ru/js/tpwf/widgets/comp/event_register.iframe.css",window.TWF2.WidgetPrototypes.event_register.prototype._locales={};
window.TWF2.WidgetPrototypes.event_register.prototype._locales.en={"К сожалению, мы не можем принять оплату за билеты, так как организатор события не подключил возможность покупки билетов через наш сайт. Чтобы оплатить выбранные билеты, рекомендуем вам связаться с организатором и уточнить, как можно оплатить участие.":"Unfortunately, event host decided not to sell tickets online. We suggest you contact the host for information about payment options.",'Продолжая регистрацию, вы&nbsp;подтверждаете свое согласие с&nbsp;условиями <a href="http://timepad.ru/upload/docs/TimePad_useragreement.pdf" target="_blank">Пользовательского соглашения</a> и':'By registering to this event you confirm your acceptance of the <a href=\\"http://timepad.ru/upload/docs/TimePad_useragreement.pdf\\" target=\\"_blank\\">User agreement</a> and the','Продолжая регистрацию, вы&nbsp;подтверждаете свое согласие с&nbsp;условиями <a href="{{event.domain}}/org/user_agreement" target="_blank">Пользовательского соглашения</a> и':'By registering to this event you confirm your acceptance of the <a href=\\"{{event.domain}}/org/user_agreement_en.pdf\\" target=\\"_blank\\">User agreement</a> and the',"Подтверждение участия будет выслано вам организаторами на адрес, указанный при регистрации. Напоминаем, что без подтверждения регистрация считается недействительной.":"Your application is received and is waiting for approval. You will be notified by e-mail when your registration is approved. Please note that your registration is not valid before it is approved!",'Я подтверждаю свое согласие с условиями <a href="http://timepad.ru/upload/docs/TimePad_useragreement.pdf" target="_blank">Пользовательского соглашения</a> и':'I confirm my acceptance of the <a href="http://timepad.ru/upload/docs/TimePad_useragreement_en.pdf" target="_blank">User agreement</a> and the',"В качестве благодарности за заказ билетов на TimePad вам предоставляется возможность выбрать один из подарков-скидок в магазинах наших партнеров!":"As a thank you for ordering your tickets at TimePad you get an opportunity to chose one of the gifts-discounts in our partners' stores.","К сожалению, организатор этого события решил не продавать билеты он-лайн. Чтобы узнать, как вы можете оплатить свое участие, свяжитесь с ним.":"Unfortunately, event host decided not to sell tickets on-line. Please, contact him for information about payment options.",'Я подтверждаю свое согласие с условиями <a href="{{event.domain}}/org/user_agreement" target="_blank">Пользовательского соглашения</a> и':'I confirm my acceptance of the <a href="{{event.domain}}/org/user_agreement_en" target="_blank">User agreement</a> and the',"Распечатайте ваши билеты прямо сейчас, если у вас есть возможность. Мы также отправили ссылки на них на почту":"Print out your tickets as soon as you have an opportunities. We've also sent links to them to","К сожалению, виджету регистрации не удалось загрузиться. Пожалуйста, обратитесь в службу поддержки по адресу":"Unfortunately this widget failed to load. Please contact our support at","Договором оказания услуг по организации мероприятия и политикой возвратов":"Event hosting services terms and the policy of returns","Вы можете попробовать зарегистрироваться на событие через систему TimePad":"You can try and register for this event with TimePad","Пожалуйста, проверьте правильность заполнения полей, выделенных красным.":"Errors detected in highlighted fields. Please correct them and try again.","Я хочу получать анонсы событий этого организатора по электронной почте":"Subscribe to organization","Платежная сессия завершена. Нажмите «Далее» для продолжения оплаты.":"Payment session expired. Press «Continue» to proceed with payment.","Не удалось соединиться с сервером. Пожалуйста, попробуйте еще раз.":"Failed to connect to server. Please try again.","Заявка отправлена. В ближайшее время организаторы свяжутся с вами.":"Request sent. Event hosts will contact you shortly.","Продолжая регистрацию, вы подтверждаете свое согласие с условиями":"By registering to this event you confirm your acceptance of the","В письме обязательно укажите событие, на которое вы их покупали.":"In your letter, make sure to specify the event for which you have bought your tickets.","Сервис временно недоступен. Пожалуйста, повторите попытку позже":"Service is temporarily unavailable. Please try again later.","К сожалению, на данный момент доступных для регистрации дат нет":"Unfortunately there are no dates left","Время оплаты заказа ограничено! До окончания платежной сессии:":"Payment period is limited! Time left till the end of payment session:","После этого вернуть введенные вами данные будет невозможно.":"It will be impossible to restore the data you've entered.","Если билеты не пришли, пожалуйста, напишите нам об этом на":"If you didn't recieve your tickets, please email us at","Код с обратной стороны карты должен состоять из трёх цифр":"CVC/CVV must contain 3 digits","Хочу получать рекомендации интересных событий от TimePad":"I want to receive recommendations of interesting events from TimePad","Необходимо подтвердить согласие с условиями и договором":"You have to confirm your acceptance of the agreement and the terms","Что-то пошло не так. Попробуйте отправить заявку позже.":"Something went wrong. Please, try to submit the request later.","мероприятие пройдет, а диплом останется у вас навсегда":"the event will pass, the diploma will stay with you forever","диплом усилит ваше резюме и поможет карьерному росту":"the diploma will enhance your résumé and help your career growth","Договором оказания услуг по организации мероприятия":"Event hosting services terms","подтверждающий вашу регистрацию на это мероприятие":"configming your registration for this event","Время брони билета ограничено. Бронь будет снята":"Your reservation will expire","В имени владельца карты слишком много символов":"Cardholder name must contains less symbols","В имени владельца карты слишком мало символов":"Cardholder name must contains more symbols","Продолжая регистрацию, вы принимаете условия":"By registering to this event you accept","и согласны на обработку персональных данных.":"and personal data processing agreement","Произошла неизвестная ошибка коммуникации:":"Unknown connection error:","согласие на обработку персональных данных":"personal data processing agreement","поделитесь вашими достижениями с близкими":"share your accomplishments with those around you","Как оплатить, получить или вернуть билет?":"Help and support","В имени владельца карты допущены ошибки":"Cardholder name is incorrect","Пожалуйста, сообщите об этом по адресу":"Please report this error at","Зарегистрироваться на событие на сайте":"You can also register on our site","Произошла ошибка на стороне сервера:":"Server returned an error:","Введите код с обратной стороны карты":"Enter CVC/CVV","Закажите электронный диплом TimePad":"Order a digital diploma by TimePad","Ваши билеты. Распечатайте их сейчас":"Here are your tickets. Print them out now.","Три последние цифры с оборота карты":"3 digits on the back","и пришлите ссылку на эту страницу":"and send us a link to this page","Некорректное значение года/месяца":"Year or month is incorrect","Или выберите другой способ оплаты":"Or you can choose a different payment method","Вы зарегистрировались на событие":"You were registered for the","Вы не выбрали ни одного билета!":"Please select at least one ticket!","В e-mail адресе допущены ошибки":"Incorrect mail","Регистрация на событие закрыта":"Event registration is closed","В номере карты допущены ошибки":"Card number is incorrect","Латинские буквы, как на карте":"Cardholder name","Сумма включает сервисный сбор":"Total includes a service fee","Выберите места на схеме зала":"Please select your seats","Пользовательского соглашения":"User agreement","Выберите место на схеме зала":"Please select your seat","Некорректное значение месяца":"Month is incorrect","Вы заказали следующие билеты":"Your order","Не удалось обработать платёж":"Failed to process the payment","нужно обязательно заполнить":"are mandatory and must be filled in","Подтверждение приема заявки":"Registration confirmation","Выберите хотя бы один билет":"Please select at least one ticket","Введите имя владельца карты":"Enter cardholder name","Поля, отмеченные звездочкой":"Fields with an asterisk","Некорректное значение года":"Year is incorrect","Отправить заявку на оплату":"Send payment request","Связаться с техподдержкой":"Contact support","Спасибо за использование":"Thank you for using","Часто задаваемые вопросы":"FAQ","Оплатите с помощью VKPay":"Pay with VKPay","Предпочитаю не указывать":"I prefer not to specify","Спасибо за регистрацию!":"Thank you for your registration!","Или выберите тип билета":"Or select your ticket","Информация о заказчике":"Customer information","Добавить еще участника":"Add another participant","Выберите способ оплаты":"Choose preferred payment method","Регистрация бесплатна.":"Registration is free","включая сервисный сбор":"including service fee","Закончить регистрацию?":"Are you sure you want to close registration form?","Перейти к регистрации":"Proceed to registration","Связь с техподдержкой":"Support","Продажа билетов через":"Sell tickets with","Выберите дату и время":"Select date and time","Промокод неправильный":"Invalid promocode","Сначала выберите дату":"Select date first","Вы не выбрали билет!":"Please select a ticket!","и подтверждаете ваше":"and","Выберите тип билетов":"Please select your tickets","Закрытие регистрации":"Registration ends","Информация о событии":"Event information","для покупки билетов!":"to buy your tickets.","Выбрать другое место":"Select another seat","Для коллег и друзей":"For friends and coworkers","Имя держателя карты":"Cardholer name","Стоимость билета — ":"Ticket price is ","Промокод не подошёл":"Invalid promocode","Показать информацию":"Contact information","Выберите тип билета":"Please select your ticket","Выбрать другую дату":"Select another date","Загрузка схемы зала":"Hall scheme loading","Изменить выбор мест":"Change seats selection","Введите номер карты":"Enter card number","Ваш платеж защищен":"This is an SSL-encrypted payment. You're safe.","Добавить участника":"Add participant","Выбрано %s билетов":"%s tickets selected","Как получить билет":"How to receive a ticket","Как оплатить билет":"How to pay for a ticket","Зарегистрироваться":"Register","Создано с помощью":"Powered by","Выбраны %s билета":"%s tickets selected","Категории билетов":"Ticket types","Укажите год/месяц":"Select year/month","Как вернуть билет":"How to return a ticket","Промокод подошёл":"Promocode accepted","E-mail заказчика":"Customer e-mail","Заполнить анкеты":"Fill the profiles","Перейти к заказу":"Proceed","Узнать подробнее":"Learn more","Введите промокод":"Enter promocode","Промокод верный":"Promocode accepted","Оплата успешна!":"Payment successfull","Нет, продолжить":"No, proceed","Выбран %s билет":"%s ticket selected","Оплатите картой":"Payment with card","Зарезервировано":"Reserved","Свободных мест":"Vacant spots","Всего к оплате":"Total amount","Выберите места":"Please select your seats","Есть промокод?":"I've got a promocode!","Выберите время":"Select time","Оплата успешна":"Payment successfull","Выберите место":"Please select your seat","Оплата участия":"Registration fee","Выберите дату":"Select date","Сумма платежа":"Total amount","Нет в продаже":"N/A","Срок действия":"Expiration date","Укажите месяц":"Select month","Кол&#8209;во":"Quantity","Общая анкета":"Common profile","Укажите год":"Select year","Код CVC/CVV":"CVC/CVV code","Распечатать":"Print","Это полезно":"It’s good","Организатор":"Organized by","Номер карты":"Card number","недоступно":"unavailable","Участник №":"Participant","Тип билета":"Ticket type","Количество":"Quantity","Для работы":"For your job","от %s руб.":"from %s RUB","Вы выбрали":"Total","Продолжить":"Proceed","Завершить":"Close","Проверить":"Verify","Применить":"Apply","если есть":"if you have one","бесплатно":"free","Заказать":"Order","Для себя":"For yourself","Внимание":"Attention","промокод":"Promocode","Название":"Name","Оплатить":"Pay","Промокод":"Promocode","на сумму":"for","Фамилия":"Last name","Удалить":"Delete","Телефон":"Phone","билетов":"tickets","%s руб.":"%s RUB","билета":"tickets","сектор":"sector","Купить":"Buy","Сектор":"Sector","Наверх":"Back to top","билеты":"tickets","рублей":"roubles","Кол‑во":"Quantity","Кол-во":"Quantity","Далее":"Continue"," руб.":" RUB","Билет":"ticket","Адрес":"Location","место":"place","Назад":"Back","Место":"Place","билет":"ticket","Сумма":"Total","Время":"Time","Цена":"Price","руб.":"RUB","стол":"table","Дата":"Date","Стол":"Table","Имя":"First name","Ряд":"Row","ряд":"row"};
window.TWF2.WidgetPrototypes.event_register.prototype._tpls._ank='<div class="b-registration__section b-registration__section_indent section-ank js-section-ank"> {{#event.uses_order_email}} <div class="row-fluid"> <div class="control-group b-reg-row" data-formname="order_mail"> <label class="b-unit__text b-registration__question"> E-mail заказчика <span class="b-registration__question_mandatory">*</span> </label> <div class="b-input-block i-question-control"> <input type="text" name="order_mail" class="span12 b-input" autocomplete="nein" value="{{{prefill.order.order_mail}}}"> </div> </div> </div> {{/event.uses_order_email}} {{#event.has_master_questions}} <div class="b-attendee-divide"> {{#event.master_questions}} {{> _question}} {{/event.master_questions}} </div> {{/event.has_master_questions}} <div class="b-attendees"> {{#attendees}} {{> _attendee_form}} {{/attendees}} </div> {{#event.uses_multiank}}{{#event.has_active_regular_tickets}} <span class="b-add-attendee hide"> {{#event.uses_ticket_choice}} <span class="add-attendee-re"> {{> _re_selector}} </span> {{/event.uses_ticket_choice}} <a href="#" class="add-attendee">Добавить участника</a> </span> {{/event.has_active_regular_tickets}}{{/event.uses_multiank}} </div> <div class="b-registration__section section-submit b-registration__section_indent"> <div class="b-registration__check"> {{#event.uses_subscribe}} <div class="b-registration__check-block"> <label class="b-registration__accept"> <input type="checkbox" name="subscribe" checked="checked"> <span>Я хочу получать анонсы событий этого организатора по электронной почте</span> </label> </div> {{/event.uses_subscribe}} {{#event.uses_digest}} <div class="b-registration__check-block"> <label class="b-registration__accept"> <input type="checkbox" name="subscribe_digest" checked="checked"> <span>Хочу получать рекомендации интересных событий от TimePad</span> </label> </div> {{/event.uses_digest}} </div> <div class="b-registration__check" data-formname="accepted_terms"> <div class="b-registration__check-block i-question-control"> <label class="b-registration__accept"> <input type="checkbox" name="accepted_terms"> {{!АХТУНГ! Кусок стринга локализуется вместе со ссылкой, с «Я подтверждаю» по одинокое «и». Если меняете ссылку, не забудьте подправить `../locales/en.yaml`}} <span>Я подтверждаю свое согласие с условиями <a href="{{event.domain}}/org/user_agreement" target="_blank">Пользовательского соглашения</a> и <a href="{{event.domain}}event/oferta/{{event.id}}" target="_blank">Договором оказания услуг по организации мероприятия и политикой возвратов</a><span class="b-registration__question_mandatory">*</span></span> </label> </div> </div> </div> {{#event.uses_charity}} <div class="b-registration__section b-registration__section_lg b-registration__section_indent b-charity js-charity"> <div class="b-card"> <div class="b-card__c"> <div class="l-flex"> <div class="l-flex__1"> <label class="b-card_checkbox"> <input type="checkbox" name="charity_accept" class="js-charity-checkbox" value="1"> Участвовать в благотворительной программе </label> </div> <div class="l-flex__0"> <a href="#" class="b-charity__expand js-charity-show">Подробнее</a> </div> <div class="l-flex__0"> <a href="#" class="b-charity__expand js-charity-hide b-charity__expand_muted hide">Скрыть</a> </div> </div> <div class="b-charity__info js-charity-info hide"> <p class="b-charity__info-text"> Помогите людям с серьезными заболеваниями вместе с благотворительным фондом «Живой». Многие помогают детям и старикам, но перед лицом серьезной болезни может оказаться человек любого возраста.<br> Каждый перечисленный вами рубль имеет значение. </p> <div class="b-charity__amount" data-formname="charity_amount"> <label for="charity-amount" class="i-question-control"> Сумма благотворительного взноса: <input type="number" class="b-input b-charity__amount-input js-charity-amount" name="charity_amount" value="{{event.charity_amount.default}}" min="{{event.charity_amount.min}}"> <span class="b-charity__amount-input-append">рублей</span> </label> </div> <p class="b-charity__disclaimer"> TimePad не получает прибыли с суммы благотворительного взноса. </p> </div> </div> </div> </div> {{/event.uses_charity}} <div class="b-registration__section section-submit b-registration__section_indent js-section-submit"> <button class="b-pro-wiget__reg-button" name="submit_register" id="eventreg_submit">Зарегистрироваться</button> {{> _button_terms_popup}} {{#event.uses_acquirings}} <div class="b-registration__acquirings b-acquirings js-acquirings"> {{#show_vkpay_button}} <img class="b-acquirings__vkpay" src="{{host}}img/twf2/acquirings/vkpay.png"> {{/show_vkpay_button}} {{#event.acquirings}} <img class="b-acquirings__{{.}}" src="{{host}}img/twf2/acquirings/{{.}}.png"> {{/event.acquirings}} </div> {{/event.uses_acquirings}} \x3c!--p class="b-registration__terms"> Поля, отмеченные звездочкой (<span class="b-registration__question_mandatory">*</span>), нужно обязательно заполнить </p--\x3e </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._attendee_form='<div class="b-attendee b-attendee-{{num}} {{#isFirst}}b-attendee-main{{/isFirst}} {{#event.uses_multiank}}b-attendee-divide{{/event.uses_multiank}}"> {{#event.uses_multiank}} <div class="b-registration__question-number" {{#isSeated}}style="background-color: {{seatedInfo.cat.color}};"{{/isSeated}}> Участник №{{displayNum}} </div> {{#event.uses_ticket_choice}} <span class="change-attendee-re" data-attendee-num="{{num}}"> {{^isSeated}} {{> _re_selector}} {{/isSeated}} {{#isSeated}} <select class="attendee-re" disabled="disabled"> <option value="{{seatedInfo.cat.id}}" class="attendee-re-option-{{seatedInfo.cat.id}}"> {{seatedInfo.cat.name}} {{#seatedInfo.placeHuman}}({{seatedInfo.placeHuman}}){{/seatedInfo.placeHuman}} </option> </select> {{/isSeated}} </span> {{/event.uses_ticket_choice}} {{#deletable}} <a href="#" class="remove-attendee">Удалить</a> {{/deletable}} {{/event.uses_multiank}} {{#questionsSet}} {{> _question}} {{/questionsSet}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._banner_diploma='<article class="b-diploma row-fluid"> <section class="b-diploma__description"> <h2>Закажите электронный диплом TimePad,</h2> <span>подтверждающий вашу регистрацию на это мероприятие.</span> <img alt="certificate image" src="/img/diploma-banner/diploma-sample.png"/> <div> <h3>Это полезно:</h3> <p><b>Для работы: </b>диплом усилит ваше резюме и поможет карьерному росту</p> <p><b>Для себя: </b>мероприятие пройдет, а диплом останется у вас навсегда</p> <p><b>Для коллег и друзей: </b>поделитесь вашими достижениями с близкими</p> </div> <a class="btn" href="{{order.diploma_url}}" target="_blank" type="button"><span>Заказать</span></a> </section> <aside class="b-diploma__offer"> <img src="/img/diploma-banner/diploma-sample.png" alt="certificate image"> <p class="b-diploma__x-price"><s>{{order.diploma_price_without_discount}} руб.</s></p> <p class="b-diploma__price">{{order.diploma_price}} руб.</p> </aside> </article> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._banner_flocktory='<div class="i-flocktory b-flocktory"> <h1 class="b-flocktory__header">{{{order.registration.firstname}}} {{{order.registration.surname}}}!</h1> <p class="b-flocktory__text"> В качестве благодарности за заказ билетов на TimePad вам предоставляется возможность выбрать один из подарков-скидок в магазинах наших партнеров! </p> <a href="https://share.flocktory.com/exchange/login?name={{{order.registration.firstname}}}%20{{{order.registration.surname}}}&email={{order.email}}&ssid=1725&bid=409" class="btn btn-success" target="_blank"> Узнать подробнее </a> </div> <img src="//flocktory.com/xmail/v1/track?partner=1725&token={{{order.user_id}}}" />',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._branding='<div class="twf2-branding"> <a href="http://special.timepad.ru/orgnew/?utm_medium=logo&utm_source=widgetFooter&utm_campaign=internalServicePromo&utm_content=event_register" target="_blank"> Продажа билетов через <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-i-tp-logo" data-svoge-class="svg-icon svg-i-tp-logo_faded"> </a> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls["_branding.thanks"]='<div class="twf2-branding"> <a href="http://special.timepad.ru/orgnew/?utm_medium=logo&utm_source=widgetFooter&utm_campaign=internalServicePromo&utm_content=event_register" target="_blank"> Спасибо за использование <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-i-tp-logo" data-svoge-class="svg-icon svg-i-tp-logo_faded"> для покупки билетов! </a> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._button_terms_popup='<div class="b-registration__section"> <div class="b-pro-widget__terms-popup b-pro-widget__terms-popup_hidden js-pro-widget-terms-popup"> Необходимо подтвердить согласие с условиями и договором <div class="b-pro-widget__terms-popup-arrow"></div> </div> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._charity_ok_text='<p class="l-unit"> <b>Оплата благотворительного взноса прошла успешно!</b> </p> <p class="l-unit"> Спасибо, что вы помогли благотворительному фонду “Живой”. Дальше мы переведем средства фонду, и у кого-то появится надежда на выздоровление. </p> <p class="l-unit"> Отчётность БФ "Живой" доступна <a href="https://livefund.ru/otchety/" target="_blank">по ссылке</a> </p> <p class="l-unit"> Спасибо, что вы с нами! <br> Команда TimePad </p>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._closing_confirmation='<div class="twf-popup-closing-confirmation"> <div class="confirmation-tint"></div> <div class="confirmation-cont"> <div class="confirmation-title">{{title}}</div> <div class="confirmation-description">{{description}}</div> <div class="confirmation-btns"> <a href="#" class="b-pro-wiget__button confirmation-btn__proceed">{{proceed}}</a> <a href="#" class="b-pro-widget__default-btn confirmation-btn__close">{{close}}</a> </div> </div> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._cloudpay='<div class="b-registration__section b-plastic-card-block"> <form id="widget_pay" class="b-plastic-card" action="post"> <input type="hidden" data-cp="expDateMonthYear" value=""> <h5 class="b-unit__header_size_small b-registration__header"> Оплатите картой: </h5> <div class="b-plastic-card-info"> <div class="b-plastic-card-info__side_front"> <label for="card-number" class="b-plastic-card-info__label">Номер карты</label> <input type="text" id="card-number" data-cp="cardNumber" class="b-plastic-card-info__input b-plastic-card-info__input_width_full" required> <div class="b-plastic-card-info__validity"> <label for="card-validity-month" class="b-plastic-card-info__label b-plastic-card-info__label_float_left b-plastic-card-info__label_line_height_3">Срок действия</label> <select id="card-validity-month" name="card-validity-month" class="b-plastic-card-info__validity-select" required> <option value="01">01</option> <option value="02">02</option> <option value="03">03</option> <option value="04">04</option> <option value="05">05</option> <option value="06">06</option> <option value="07">07</option> <option value="08">08</option> <option value="09">09</option> <option value="10">10</option> <option value="11">11</option> <option value="12">12</option> </select> <span class="b-plastic-card-info__slash">/</span> <select id="card-validity-year" name="card-validity-year" class="b-plastic-card-info__validity-select" required></select> </div> <label for="card-name" class="b-plastic-card-info__label b-plastic-card-info__label_mobile">Имя держателя карты</label> <input id="card-name" type="name" name="name" class="b-plastic-card-info__input b-plastic-card-info__input_width_full" placeholder="IVANOV IVAN" autocomplete="nein" required> <div class="b-plastic-card-info__caption">Латинские буквы, как на карте</div> </div> <div class="b-plastic-card-info__side_back"> <label for="card-cvc" class="b-plastic-card-info__label">Код CVC/CVV</label> <input type="text" id="card-cvc" data-cp="cvv" class="b-plastic-card-info__input b-plastic-card-info__input_width_small" maxlength="3" required> <div class="b-plastic-card-info__caption b-plastic-card-info__caption_color_dark">Три последние цифры с оборота карты</div> </div> </div> <ul id="pay_errors"></ul> <div class="b-plastic-card-info__submit-block"> <button type="submit" class="b-pro-wiget__pay-button b-plastic-card-info__button-submit">Оплатить</button> <div class="b-plastic-card-info__secure-block"> <span>Ваш платеж защищен</span> </div> <div class="b-plastic-card-info__secure-logos"> <img src="{{host}}img/cloudpayments/visa.png" alt="Verified by Visa" width="46px" height="20px"/> <img src="{{host}}img/cloudpayments/mastercard.png" alt="MasterCard SecureCode" width="56px" height="20px"/> <img src="{{host}}img/cloudpayments/pcidss.png" alt="PCI DSS" width="52px" height="20px"/> </div> </div> </form> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._errorBlock='<div class="b-error-block"> <div class="b-error"> <div class="b-error__arrow-block"></div> <span>{{{errorText}}}</span> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._event='<div class="b-event js-section-event"> {{#event.image}} <div class="b-event__pic" style="background-image: url(\'{{event.image}}\');"></div> {{/event.image}} <h5 class="b-unit__header_size_small b-event__header"> {{{event.name}}} </h5> <div class="b-event__info"> {{#event.place}} <div class="row-fluid b-event__info-elem"> <div class="span3 b-unit__text_size_small b-unit__text_color_gray"> Место: </div> <div class="span9"> <span class="b-unit__text_size_small b-unit__text_color_black"> {{#event.city}}{{{event.city}}}, {{/event.city}} {{{event.place}}} </span> </div> </div> {{/event.place}} <div class="row-fluid b-event__info-elem"> <div class="span3 b-unit__text_size_small b-unit__text_color_gray"> Организатор: </div> <div class="span9"> <span class="b-unit__text_size_small b-unit__text_color_black"> {{{event.organization_name}}} </span> </div> </div> <div class="row-fluid b-event__info-elem"> <div class="span3 b-unit__text_size_small b-unit__text_color_gray"> Время: </div> <div class="span9"> <span class="b-unit__text_size_small b-unit__text_color_black"> {{event.datetime}} </span> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._faq='<p class="b-unit__text b-unit__text_color_gray">Часто задаваемые вопросы</p> <ul id="widget_faq"> <li><a target="_blank" href="http://help.timepad.ru/5588/{{#event.locale_ru}}80128{{/event.locale_ru}}{{^event.locale_ru}}334588{{/event.locale_ru}}">Как оплатить билет?</a></li> <li><a target="_blank" href="http://help.timepad.ru/5588/{{#event.locale_ru}}80127{{/event.locale_ru}}{{^event.locale_ru}}334590{{/event.locale_ru}}">Как получить билет?</a></li> <li><a target="_blank" href="http://help.timepad.ru/5588/{{#event.locale_ru}}take_money_back_to_me{{/event.locale_ru}}{{^event.locale_ru}}334591{{/event.locale_ru}}">Как вернуть билет?</a></li> </ul> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._footer='<p class="b-registration__footer"> <a href="http://special.timepad.ru/orgnew/?utm_medium=logo&utm_source=widgetFooter&utm_campaign=internalServicePromo&utm_content=event_register" target="_blank"><img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-i-tp-logo" data-svoge-class="svg-icon svg-i-tp-logo_faded"></a> </p> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._header_image='{{#settings.showEventInfoHeaderEverywhere}} <div class="b-payment-poster"> <style> .b-payment__poster:after { background-color: {{event.selective_color}}; } </style> <div class="b-payment__poster" style="background-image: url(\'{{event.image}}\')"> <h1 class="b-payment__poster-header">{{{event.name}}}</h1> <div class="b-payment__event-more"> <p class="b-payment__event-more-text"> <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-twf2-datetime" data-svoge-class="svg-icon svg-icon_little svg-icon_white"> {{{event.date_human}}} </p> {{#event.city}}<p class="b-payment__event-more-text"> <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-twf2-place" data-svoge-class="svg-icon svg-icon_little svg-icon_white"> {{event.city}}{{#event.place}}, {{{event.place}}}{{/event.place}} </p>{{/event.city}} </div> </div> </div> {{/settings.showEventInfoHeaderEverywhere}}',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._order='<div class="b-registration__section b-registration__section_indent"> <h5 class="b-unit__header_size_small b-registration__header"> Вы заказали следующие билеты: </h5> </div> <div class="row-fluid b-reg-table b-reg-table_type_striped b-payment__tickets"> <div> <div class="row-fluid b-reg-table__row b-reg-table__row_header"> <div class="{{#order.payment.id}}span7{{/order.payment.id}} {{^order.payment.id}}span10{{/order.payment.id}} b-reg-table__cell"> <h3 class="b-reg-table__header b-reg-table__text">Тип билета</h3> </div> {{#order.payment.id}} <div class="span3 b-reg-table__cell"> <h3 class="b-reg-table__header b-reg-table__text">Цена</h3> </div> {{/order.payment.id}} <div class="span2 b-reg-table__cell"> <h3 class="b-reg-table__header b-reg-table__text"><span>Кол&#8209;во</span></h3> </div> </div> {{#order.regevents}} <div class="row-fluid b-reg-table__row"> <div class="{{#order.payment.id}}span7{{/order.payment.id}} {{^order.payment.id}}span10{{/order.payment.id}} b-reg-table__cell"> <span class="b-reg-table__text">{{{name}}}</span> </div> {{#order.payment.id}} <div class="span3 b-reg-table__cell"> <span class="b-reg-table__text">{{price_human}}</span> </div> {{/order.payment.id}} <div class="span2 b-reg-table__cell"> <span class="b-reg-table__text">{{tickets}}</span> </div> </div> {{/order.regevents}} {{#order.charity_payment}} <div class="row-fluid b-reg-table__row"> <div class="span7 b-reg-table__cell"> <span class="b-reg-table__text">Благотворительный взнос</span> </div> <div class="span5 b-reg-table__cell"> <span class="b-reg-table__text">{{order.charity_payment.sum}} руб.</span> </div> </div> {{/order.charity_payment}} {{#order.total}} <div class="row-fluid b-reg-table__row"> <div class="span10 b-reg-table__cell"> <span class="b-reg-table__text"> Всего к оплате {{order.total_human}} {{#order.payment.topComission}} (включая сервисный сбор {{order.payment.topComission_human}}) {{/order.payment.topComission}} </span> </div> {{#order.payment.id}} <div class="span2 b-reg-table__cell"> <span class="b-reg-table__text"></span> </div> {{/order.payment.id}} </div> {{/order.total}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._policyResult='{{#policyResult.applied_policies}}{{#.}} <div class="row-fluid b-reg-table__row b-reg-table__row_type_promo policyResultRow"> <div class="span12 b-reg-table__cell"> <div class="b-reg-table__text b-input-block__promo-btn-text b-reg-table__text-policy-result">{{.}}</div> </div> </div> {{/.}}{{/policyResult.applied_policies}}',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._promocodeBlock='{{#event.has_promocode}} {{^hidePromocodeInput}} <form class="b-registration__section b-registration__section_indent b-registration__section_no-bottom-space js-section-promocodeBlock"> <div class="row-fluid {{#event.promocode_wrong}}error{{/event.promocode_wrong}}" id="promoCode" data-formname="promocode"> <div class="control-group b-reg-row"> <label class="b-unit__text b-registration__question"> Промокод{{#ifYouHavePromocode}} (если есть){{/ifYouHavePromocode}} </label> <div class="b-input-block b-input-block_type_promocode {{#lastUserInputtedPromocode}}{{#event.promocode_wrong}}b-input-block_type_promocode-not-success{{/event.promocode_wrong}}{{#event.promocode_ok}}b-input-block_type_promocode-success{{/event.promocode_ok}}{{/lastUserInputtedPromocode}}"> <div class="b-input-block__left-table-cell"> <input type="text" name="promocode" class="span12 b-input b-input_promocode" id="promocodeInput" autocomplete="nein" value="{{lastUserInputtedPromocode}}"> </div> <div class="b-input-block__right-table-cell"> <button type="submit" name="apply_promocode" class="b-input-block__promo-btn"> <span class="b-input-block__promo-btn-text"> {{#lastUserInputtedPromocode}} {{#event.promocode_wrong}} Промокод неправильный {{/event.promocode_wrong}} {{#event.promocode_ok}} Промокод верный {{/event.promocode_ok}} {{/lastUserInputtedPromocode}} {{^lastUserInputtedPromocode}} Проверить {{/lastUserInputtedPromocode}} </span> </button> </div> </div> </div> </div> </form> {{/hidePromocodeInput}} {{/event.has_promocode}} ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._question='<div class="row-fluid"> <div class="control-group b-reg-row {{#meta.dadata}}js-dadata{{/meta.dadata}}" data-formname="{{formname}}" data-tag="{{{tag}}}" data-type="{{{type}}}"> <label class="b-unit__text b-registration__question"> {{{name}}} {{#mandatory}}<span class="b-registration__question_mandatory">*</span>{{/mandatory}} </label> {{#text}} <div class="b-input-block i-question-control"> <input type="text" name="{{formname}}" class="span12 b-input" autocomplete="nein" value="{{{value}}}"> </div> {{/text}} {{#bigtext}} <div class="b-input-block i-question-control"> <textarea rows="3" class="span12 b-input b-input_type_textarea" name="{{formname}}" autocomplete="nein">{{{value}}}</textarea> </div> {{/bigtext}} {{#radio}} <div class="b-registration__check-block i-question-control"> {{^meta.radioselect}} {{^mandatory}} <div class="b-input-block"> <label class="b-registration__label"> <input class="b-radio" type="radio" value="0" name="{{formname}}" checked="checked"> <span>Предпочитаю не указывать</span> </label> </div> {{/mandatory}} {{#vars_unfold}} <div class="b-input-block"> <label class="b-registration__label"> <input class="b-radio" type="radio" value="{{num}}" name="{{formname}}" {{#checked}}checked="checked"{{/checked}}> <span>{{text}}</span> </label> </div> {{/vars_unfold}} {{/meta.radioselect}} {{#meta.radioselect}} <div class="b-input-block"> <select name="{{formname}}"> {{^mandatory}} <option value="0">Предпочитаю не указывать</option> {{/mandatory}} {{#vars_unfold}} <option value="{{num}}" {{#checked}}selected="selected"{{/checked}}>{{text}}</option> {{/vars_unfold}} </select> </div> {{/meta.radioselect}} </div> {{/radio}} {{#multivar}} <div class="b-registration__check-block i-question-control"> {{#vars_unfold}} <div class="b-input-block"> <label class="b-registration__label"> <input type="checkbox" class="b-radio" value="{{num}}" value="{{aname}}" name="{{aname}}" {{#checked}}checked="checked"{{/checked}}> <span>{{text}}</span> </label> </div> {{/vars_unfold}} </div> {{/multivar}} {{#upload}} <div class="i-question-control"> <input type="hidden" name="{{formname}}" role="uploadcare-uploader-outer" data-autostore="true" data-public-key="{{event.uc_publickey}}" data-locale="{{event.locale}}" data-tabs="file url dropbox vk" data-images-only="false" data-path-value="true" data-preview-step="false" data-clearable="false" data-multiple="false" data-crop="disabled" /> </div> {{/upload}} {{#phone}} <div class="b-input-block i-question-control"> <input type="text" name="{{formname}}" data-phone-verify="{{formname}}" class="js-tpphone {{#uses_phone_verify}}js-verify-phone{{/uses_phone_verify}} span12 b-input" value="{{{value}}}"> </div> {{/phone}} {{#description}}<span class="help-block b-registration__question_comment">{{{description}}}</span>{{/description}} </div> </div> {{#phone}} {{#uses_phone_verify}} <div class="row-fluid {{^mandatory}}js-verify-block-hideble hide{{/mandatory}}" data-phone-verify="{{formname}}"> <div class="control-group b-reg-row"> <label class="b-unit__text b-registration__question js-verify-label js-verify-label_nophone">Подтверждение телефона</label> <div class="twf2-danger-plate js-verify-info js-verify-info-danger twf2-unit" data-phone-verify="{{formname}}" style="display: none;"></div> <button class="b-pro-wiget__button b-pro-widget__small-button js-verify-btn" disabled="disabled" type="button" data-phone-verify="{{formname}}">Выслать код по SMS</button> <label class="b-unit__text b-registration__question js-verify-label" style="display: none;">Код подтверждения</label> <div class="twf2-warning-plate js-verify-info js-verify-info-warning twf2-unit" data-phone-verify="{{formname}}" style="display: none;"> На указанный номер выслан код. Введите этот код для подтверждения вашего телефона. Если по каким-либо причинам код не пришел, отправить новый код можно по ссылке ниже. </div> <div class="twf2-success-plate js-verify-info js-verify-info-success twf2-unit" data-phone-verify="{{formname}}" style="display: none;"> Код верный! Ваш телефон подтвержден, спасибо :) </div> <input type="text" name="{{phone_verify_formname}}" class="span12 b-input js-verify-code" autocomplete="nein" value="" style="display: none" data-phone-verify="{{formname}}"> <span class="help-block b-registration__question_comment js-verify-desc js-verify-desc_nophone" data-phone-verify="{{formname}}">Сначала неообходимо ввести телефон</span> <span class="help-block b-registration__question_comment js-verify-desc js-verify-desc_preresend" data-phone-verify="{{formname}}" style="display: none;">Повторно отправить код можно будет через <span class="js-verify-timer">00:00</span></span> <a href="#" class="help-block b-registration__question_comment js-verify-desc js-verify-desc_resend js-verify-resend" data-phone-verify="{{formname}}" style="display: none;">Отправить код еще раз</a> </div> </div> {{/uses_phone_verify}} {{/phone}}',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._re_selector='<select class="attendee-re js-section-re_selector"> {{#event.tickets}} <option value="{{id}}" class="attendee-re-option-{{id}}">{{{name}}} ({{h_price}})</option> {{/event.tickets}} </select>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._registrant='<h5 class="b-unit__header_size_small b-registration__header"> Информация о заказчике </h5> <div class="b-event__info"> {{^event.uses_order_email}} <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray"> Имя: </span> </div> <div class="span6"> <span class="b-unit__text b-unit__text_color_black"> {{{order.registration.firstname}}} {{{order.registration.surname}}} </span> </div> </div> {{/event.uses_order_email}} <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray"> E-mail: </span> </div> <div class="span6"> <span class="b-unit__text b-unit__text_color_black"> {{order.email}} </span> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._seat_info='<div class="row-fluid b-reg-table__row b-reg-table__row_fluid" id="seat_cont_{{place.id}}"> <div class="span9 b-reg-table__cell"> <div class="b-reg-table__text">{{cat.name}}</div> <div class="help-block b-reg-table__category-description">{{placeHuman}}</div> </div> <div class="span3 b-reg-table__cell"> <div class="b-reg-table__text">{{cat.price}} руб.</div> </div> <span class="close">×</span> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._seatcheck='<h5 class="b-unit__header_size_small b-registration__header schk__widget-header"> {{#event.uses_multireg}} Выберите места: {{/event.uses_multireg}} {{^event.uses_multireg}} Выберите место: {{/event.uses_multireg}} </h5> {{#event.uses_preloader}} <div class="schk-wrap"> <div class="schk-loader"> <div class="schk-loader__text">Загрузка схемы зала</div> </div> <div class="schk-tooltip schk-tooltip_preloader" style="opacity:0;"> <p class="schk-tooltip__row"></p> </div> </div> {{/event.uses_preloader}} {{^event.uses_preloader}} <div class="schk-wrap__cover"> <div class="schk-loader"> <div class="schk-loader__text">Загрузка схемы зала</div> </div> <div class="schk-fixator"> <div class="schk-wrap schk-wrap_bounded"> </div> </div> <div class="schk-wrap__cover-btn-wrap js-schk-wrap__cover-btn-wrap" style="display: none;"> <div class="schk-wrap__cover-btn-bg"> <a class="ep3-like-btn ep3-like-btn_static js-schk-wrap__cover-btn" href="#"> {{#event.uses_multireg}} Выберите места на схеме зала {{/event.uses_multireg}} {{^event.uses_multireg}} Выберите место на схеме зала {{/event.uses_multireg}} </a> </div> </div> <div class="schk-wrap_preview js-schk-wrap_preview"></div> </div> {{/event.uses_preloader}} <div class="b-registration__section" style="display: none;"> <div class="row-fluid b-reg-table b-reg-table_without-header" id="places_list"> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._seatcheck_modal='<div class="schk-modal"> {{#event.uses_preloader}} <div class="schk-loader schk-loader_full"> <div class="schk-loader__text">Загрузка схемы зала</div> </div> {{/event.uses_preloader}} <div class="schk-modal__scheme-wrap"> <div class="schk-modal__scheme"> <div class="schk-scheme__header"> <div class="schk-scheme__header-text"> {{#event.uses_multireg}} Выберите места на схеме зала {{/event.uses_multireg}} {{^event.uses_multireg}} Выберите место на схеме зала {{/event.uses_multireg}} </div> </div> <div class="schk-scheme__scheme"> {{#event.uses_preloader}} <div class="schk-wrap schk-wrap_stretched"></div> {{/event.uses_preloader}} </div> <div class="schk-scheme__footer"> <div class="schk-scheme__back-btn"> <a href="#" class="ep3-like-btn ep3-like-btn_brand-info js-proceed-btn">Назад</a> </div> <div class="schk-scheme__selected-num"></div> <div class="schk-scheme__proceed-btn"> <a href="#" class="ep3-like-btn js-proceed-btn">К заказу</a> </div> </div> </div> </div> <div class="schk-modal__zoom-wrap"> <div class="schk-modal__zoom"> <div class="zoom__round-btn js-schk-zoom-in"> <i class="schk-icon-zoom-in schk-icon-24"></i> </div> <div class="zoom__round-btn js-schk-zoom-out"> <i class="schk-icon-zoom-out schk-icon-24"></i> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._selectTickets='<div class="b-registration__section js-section-selectTickets"> {{#event.uses_ticket_choice}} {{#event.tickets.length}} <h5 class="b-unit__header_size_small b-registration__header b-indentable"> {{#event.uses_multireg}} Выберите тип билетов: {{/event.uses_multireg}} {{^event.uses_multireg}} {{#event.has_active_places}} Или выберите тип билета: {{/event.has_active_places}} {{^event.has_active_places}} Выберите тип билета: {{/event.has_active_places}} {{/event.uses_multireg}} </h5> {{/event.tickets.length}} {{/event.uses_ticket_choice}} {{^event.promocode_locked}} <div class="row-fluid b-reg-table b-reg-table_type_striped"> <div class="span12"> {{#event.uses_ticket_choice}} {{#event.tickets.length}} <div class="row-fluid b-reg-table__row b-reg-table__row_header"> <div class="{{#event.uses_multireg}}span6{{/event.uses_multireg}}{{^event.uses_multireg}}span9{{/event.uses_multireg}} b-reg-table__cell b-reg-table__cell-name"> <h3 class="b-reg-table__header b-reg-table__text">Тип билета</h3> </div> <div class="span3 b-reg-table__cell b-reg-table__cell-price"> <h3 class="b-reg-table__header b-reg-table__text">Цена</h3> </div> {{#event.uses_multireg}} <div class="span2 b-reg-table__cell b-reg-table__cell-count"> <h3 class="b-reg-table__header b-reg-table__text"> <span>Кол&#8209;во</span> </h3> </div> {{/event.uses_multireg}} </div> {{/event.tickets.length}} {{#event.tickets}} <div class="row-fluid b-reg-table__row {{#has_promocode}}b-reg-table__row_type_promo{{/has_promocode}}" id="rei_cont_{{id}}"> <div class="{{#event.uses_multireg}}span6{{/event.uses_multireg}}{{^event.uses_multireg}}span9{{/event.uses_multireg}} b-reg-table__cell b-reg-table__cell-name"> <label class="b-reg-table__text {{^event.uses_multireg}} b-reg-table__text_with_radio{{/event.uses_multireg}}" for="rei_{{id}}"> {{^event.uses_multireg}} <input {{#force_check}}checked="checked"{{/force_check}} type="radio" class="b-reg-table__select b-radio_where_table" name="re_id" data-reid="{{id}}" value="{{id}}" id="rei_{{id}}" {{^available}}disabled="disabled"{{/available}}> {{/event.uses_multireg}} {{{name}}} </label> <div class="b-reg-table__price-mobile{{^event.uses_multireg}} b-reg-table__price-mobile_non-multireg{{/event.uses_multireg}}"> <span>{{h_price}}</span> </div> {{#comment}} <span class="help-block b-reg-table__category-description {{^event.uses_multireg}}b-reg-table__category-description_type_multireg{{/event.uses_multireg}}">{{{comment}}}</span> {{/comment}} {{#text_tickets_remain}} <span class="help-block b-reg-table__category-description {{^event.uses_multireg}}b-reg-table__category-description_type_multireg{{/event.uses_multireg}}">{{{text_tickets_remain}}}</span> {{/text_tickets_remain}} {{^event.uses_multireg}} <span class="help-block b-reg-table__category-description b-reg-table__category-description_type_multireg">Закрытие регистрации {{ttl}}</span> {{/event.uses_multireg}} </div> <div class="span3 span3_fixed-width b-reg-table__cell b-reg-table__cell-price"> <span class="b-reg-table__text b-not-bold">{{h_price}}</span> </div> <div class="{{#event.uses_multireg}}span2{{/event.uses_multireg}}{{^event.uses_multireg}}span4{{/event.uses_multireg}} b-reg-table__cell b-reg-table__cell-count"> {{#available}} {{#event.uses_multireg}} {{^settings.use_plusminus}} <select class="b-reg-table__select" name="res[{{id}}]" data-reid="{{id}}" id="rei_{{id}}"> <option value="0">&mdash;</option> {{#ticket_choices}} <option value="{{val}}" {{#selected}}selected="selected"{{/selected}}>{{val}}</option> {{/ticket_choices}} </select> {{/settings.use_plusminus}} {{#settings.use_plusminus}} <div class="b-reg-table__plusminus js-plusminus" data-plusminus-min="{{min}}" data-plusminus-max="{{max}}"> <button class="b-reg-table__plusminus_btn not-touch js-svoge-fallback js-plusminus_minus" type="button"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-plusminus-minus" data-svoge-class=""> </button> <span class="b-reg-table__plusminus-value js-plusminus_display">{{default_count}}</span> <input class="js-tickets_count_input js-plusminus_value" type="hidden" name="res[{{id}}]" data-reid="{{id}}" id="rei_{{id}}" autocomplete="nein" value="{{default_count}}"> <button class="b-reg-table__plusminus_btn js-svoge-fallback not-touch js-plusminus_plus" type="button"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-plusminus-plus" data-svoge-class=""> </button> </div> {{/settings.use_plusminus}} {{/event.uses_multireg}} <span class="hide multiank_counter b-reg-table__text">0</span> {{/available}} {{^available}} недоступно {{/available}} </div> </div> {{/event.tickets}} {{/event.uses_ticket_choice}} {{^event.uses_ticket_choice}} {{#event.tickets}} <input type="hidden" name="re_id" class="b-reg-table__hidden" data-reid="{{id}}" value="{{id}}" id="rei_{{id}}"> {{/event.tickets}} {{/event.uses_ticket_choice}} <div class="row-fluid b-reg-table__row"> <div class="span12 b-reg-table__cell"> <div class="selectedTicketsInfo b-reg-table__text"></div> </div> </div> </div> </div> {{/event.promocode_locked}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._support='<div class="b-event__support-info"> <div class="b-unit__header_size_mid">Связь с техподдержкой:</div> <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray">Телефон:</span> </div> <div class="span6"> <span class="b-unit__text b-unit__text_color_black">+7 (499) 653-68-18</span> </div> </div> <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray">E-mail:</span> </div> <div class="span6"> <a class="b-unit__text b-unit__text_color_black" href="mailto:support@timepad.ru">support@timepad.ru</a> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._timer='<div class="b-registration__section"> <div class="js-timer twf2-timer"> <div class="twf2-timer__left"> <span class="twf2-timer-text">Время оплаты заказа ограничено! До окончания платежной сессии:</span> <span class="twf2-timer-text_retry">Платежная сессия завершена. Нажмите «Далее» для продолжения оплаты.</span> </div> <div class="twf2-timer__right"> <div class="twf2-timer__container"> <div class="js-timer-clock twf2-timer__clock"></div> <div class="js-timer-retry twf2-timer__retry"> <a href="#" class="js-timer-retry-btn twf-2-timer__retry-btn">Далее</a> </div> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.button='<button class="btn btn-large btn-info b-pro-widget__open-button open_widget">Зарегистрироваться</button>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.charity='<div class="i-page"> {{#isInTimepad}} <div class="b-registration__section_indent"> {{^isInPaymentPage}} <h1 class="b-payment__header"> Благотворительный взнос </h1> {{/isInPaymentPage}} </div> {{/isInTimepad}} <div class="b-registration__section b-registration__section_indent"> {{^isInTimepad}} <h2 class="b-unit__header b-unit__header_size_mid b-unit__header_payment_main"> Благотворительный взнос </h2> {{/isInTimepad}} </div> <div class="row-fluid b-reg-table b-reg-table_type_striped b-payment__tickets"> <div> <div class="row-fluid b-reg-table__row"> <div class="span10 b-reg-table__cell"> <span class="b-reg-table__text">Благотворительный взнос</span> </div> <div class="span2 b-reg-table__cell"> <span class="b-reg-table__text">{{order.charity_payment.sum}} руб.</span> </div> </div> <div class="row-fluid b-reg-table__row"> <div class="span10 b-reg-table__cell"> <span class="b-reg-table__text"> Всего к оплате {{order.charity_payment.sum}} руб. </span> </div> </div> </div> </div> {{#order.charity_payment.cardPaymentActive}} {{> _cloudpay}} {{/order.charity_payment.cardPaymentActive}} <div class="b-registration__section b-registration__section_indent"> {{#order.charity_payment.paymentMethods}} <div class="b-payment"> {{#order.charity_payment.cardPaymentActive}} {{#order.charity_payment.paymentMethods.link.length}} <h5 class="b-unit__header_size_small b-registration__header">Или выберите другой способ оплаты:</h5> {{/order.charity_payment.paymentMethods.link.length}} {{/order.charity_payment.cardPaymentActive}} {{^order.charity_payment.cardPaymentActive}} <h5 class="b-unit__header_size_small b-registration__header">Выберите способ оплаты:</h5> {{/order.charity_payment.cardPaymentActive}} {{#order.charity_payment.paymentMethods.link}} <a href="{{#available}}{{url}}{{/available}}{{^available}}javascript:false{{/available}}" class="b-payment__method {{#available}}redirect{{/available}} {{^available}}b-payment__method-disabled{{/available}}"> <img class="b-payment__method-icon" src="{{host}}img/paybutton/{{button}}_ru.png"> <span class="b-payment__method-label">{{label}}</span> {{#comment}}<span class="b-payment__method-comment">{{comment}}</span>{{/comment}} </a> {{/order.charity_payment.paymentMethods.link}} </div> {{/order.charity_payment.paymentMethods}} {{> _support}} {{> _faq}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.main='<div class="i-page"> {{> _header_image}} {{#event.is_recurring}} <div class="b-registration__section b-registration__section_indent"> <div class="b-date-choice__day"> {{selectedRecurringEvent.date_h}} <a class="js-open-date-choice b-date-choice__select-date" href="#">Выбрать другую дату</a> </div> </div> {{/event.is_recurring}} <div class="b-registration__section"> {{#event.texts.reg_desc}} <p class="b-reg-descr">{{{event.texts.reg_desc}}}</p> {{/event.texts.reg_desc}} </div> {{> _promocodeBlock}} <form id="eventreg_form" action="{{event.domain}}event/widget_register/{{event.id}}"> {{#event.uses_places}} {{#event.has_active_places}} {{> _seatcheck}} {{/event.has_active_places}} {{/event.uses_places}} {{> _selectTickets}} {{^event.promocode_locked}} {{#event.uses_multiank}} <div class="b-registration__section hide section-multiankadd"> <div class="b-add-attendees"> <a class="b-pro-wiget__reg-button b-pro-widget__reg-button_multiank add-attendees" href="">Заполнить анкеты</a> </div> </div> {{/event.uses_multiank}} {{> _branding }} <div class="b-registration__section b-registration__section_no-bottom-space"> <div class="b-registration__error hide"></div> </div> {{> _ank }} {{/event.promocode_locked}} </form> <div class="b-registration__bottom"></div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.pay='<div class="i-page"> {{#isInTimepad}} <div class="b-registration__section_indent"> {{^isInPaymentPage}} <h1 class="b-payment__header"> Оплата участия <div class="b-payment__help"> <a target="_blank" href="http://help.timepad.ru/5588?kb_language={{#event.locale_ru}}ru_RU{{/event.locale_ru}}{{^event.locale_ru}}en_US{{/event.locale_ru}}"> <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="glyphicon-question-sign"> Как оплатить, получить или вернуть билет? </a> </div> </h1> {{#showEventDetailsAtPayment}} {{! При оплате по ссылке — подробная инфа о событии !}} <div class="b-payment__info"> <h5 class="b-payment__info-header">Информация о событии</h5> <table class="b-payment__info-body"> {{#event.name}} <tr> <td class="b-payment__info-field">Название</td> <td class="b-payment__info-value">{{{event.name}}}</td> </tr> {{/event.name}} {{#event.datetime}} <tr> <td class="b-payment__info-field">Дата</td> <td class="b-payment__info-value">{{event.datetime}}</td> </tr> {{/event.datetime}} {{#event.place}} <tr> <td class="b-payment__info-field">Адрес</td> <td class="b-payment__info-value">{{#event.city}}{{event.city}}, {{/event.city}}{{{event.place}}}</td> </tr> {{/event.place}} </table> </div> {{/showEventDetailsAtPayment}} {{/isInPaymentPage}} </div> {{/isInTimepad}} {{! #event.image}} {{! > _header_image}} {{! /event.image}} <div class="b-registration__section b-registration__section_indent"> {{^isInTimepad}} <h2 class="b-unit__header b-unit__header_size_mid b-unit__header_payment_main"> Оплата участия </h2> {{> _registrant}} {{/isInTimepad}} </div> {{> _order}} {{> _branding }} {{> _timer}} {{#order.payment.cardCloudPaymentActive}} {{> _cloudpay}} {{/order.payment.cardCloudPaymentActive}} <div class="b-registration__section b-registration__section_indent"> {{#order.payment.paymentMethods}} <div class="b-payment"> {{#order.payment.cardPaymentActive}} {{#order.payment.paymentMethods.link.length}} <h5 class="b-unit__header_size_small b-registration__header">Или выберите другой способ оплаты:</h5> {{/order.payment.paymentMethods.link.length}} {{/order.payment.cardPaymentActive}} {{#show_vkpay_button}} <h5 class="b-unit__header_size_small b-registration__header">Оплатите с помощью VK Pay:</h5> <a href="#" class="b-payment__method b-payment__method_vkpay js-vkpay"> <img class="b-payment__vkpay-btn-logo" src="{{host}}img/paybutton/vkpay_big.png"> </a> {{/show_vkpay_button}} {{^order.payment.cardPaymentActive}} <h5 class="b-unit__header_size_small b-registration__header"> {{#show_vkpay_button}} Или выберите другой способ оплаты: {{/show_vkpay_button}} {{^show_vkpay_button}} Выберите способ оплаты: {{/show_vkpay_button}} </h5> {{/order.payment.cardPaymentActive}} {{#order.payment.paymentMethods.link}} <a href="{{#available}}{{url}}{{/available}}{{^available}}javascript:false{{/available}}" class="b-payment__method {{#available}}redirect{{/available}} {{^available}}b-payment__method-disabled{{/available}}"> <img class="b-payment__method-icon" src="{{host}}img/paybutton/{{button}}_ru.png"> <span class="b-payment__method-label">{{label}}</span> {{#comment}}<span class="b-payment__method-comment">{{comment}}</span>{{/comment}} </a> {{/order.payment.paymentMethods.link}} </div> {{#order.payment.topComission}} <div class="b-registration__notice"> Сумма включает сервисный сбор: {{order.payment.topComission_human}} </div> {{/order.payment.topComission}} {{#order.pay_till}} \x3c!--div class="b-registration__notice"> <div class="b-registration__notice-heading">Внимание!</div> Время брони билета ограничено. Бронь будет снята {{order.pay_till_relative}}. </div--\x3e {{/order.pay_till}} {{/order.payment.paymentMethods}} {{^order.payment.paymentMethods}} <div class="b-registration__notice no-contract__notice"> К сожалению, организатор этого события решил не продавать билеты он-лайн. Чтобы узнать, как вы можете оплатить свое участие, свяжитесь с ним. <div class="send-pay-request"> <a href="#" class="b-pro-widget__btn_small">Отправить заявку на оплату</a> </div> </div> {{/order.payment.paymentMethods}} {{> _support}} {{> _faq}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.pending='<div class="i-page i-jquery i-less i-bootstrap section-pending"> <div class="b-registration__section"> <h2 class="b-unit__header b-unit__header_size_mid"> <img src="{{host}}img/reg2assets/reg-star.png">Подтверждение приема заявки </h2> <div class="b-reg-descr"> {{{event.texts.reg_pending}}} </div> </div> <div class="b-registration__section"> {{> _registrant}} {{> _order}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.select_date='<div class="i-page"> {{> _header_image}} <div class="b-registration__section b-registration__section_indent"> {{#event.has_recurring_events_by_day}} <div class="b-date-choice__header"> Выберите дату и время </div> {{/event.has_recurring_events_by_day}} <div class="b-date-choice"> {{#event.recurring_events_by_day}} {{^squishRecurringDates}} <div class="b-date-choice__day"> {{day}}, {{day_of_week}} </div> {{/squishRecurringDates}} {{#events}} <div class="js-date-choice b-date-choice__event {{#isCurrent}}b-date-choice__event_status_active{{/isCurrent}} {{#unavaliable}}b-date-choice__event_status_inactive{{/unavaliable}}" data-event-id="{{id}}"> <div class="b-date-choice__row"> <div class="b-date-choice__col1"> {{#squishRecurringDates}}{{day}}, {{day_of_week}}, {{/squishRecurringDates}} {{time}} </div> <div class="b-date-choice__col2"> {{#tickets_limited}}{{tickets_left_h}}{{/tickets_limited}} {{^tickets_limited}}&nbsp;{{/tickets_limited}} </div> <div class="b-date-choice__col3"> {{^unavaliable}}{{min_price_h}}{{/unavaliable}} {{#unavaliable}}Нет в продаже{{/unavaliable}} </div> </div> </div> {{/events}} {{/event.recurring_events_by_day}} {{^event.recurring_events_by_day}} {{{event.texts.reg_closed}}} {{/event.recurring_events_by_day}} </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.select_date_vertical='<div class="i-page"> <div class="b-registration__section b-registration__section_indent"> {{#event.has_recurring_events_by_day}} <div class="b-date-choice__header"> Выберите дату и время </div> {{/event.has_recurring_events_by_day}} <div class="js-tooltip schk-tooltip"> <div class="schk-tooltip__wrap" style="min-width: 89px;"> <div class="schk-tooltip__row schk-tooltip__row_cat"> <div class="schk-tooltip__b schk-tooltip__b_cat-name">Свободных мест</div> </div> <div class="schk-tooltip__row schk-tooltip__row_price"> <div class="js-tooltip-tickets-left schk-tooltip__b schk-tooltip__b_price"></div> </div> </div> <div class="schk-tooltip__arrow schk-tooltip__arrow_bottom"></div> </div> <div class="b-date-choice_vertical js-gridscroller" data-disabled-class="__pager_disabled"> <div class="__pager_left js-gridscroller__left"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-scroll-left" data-svoge-class=""> </div> <div class="__pager_right js-gridscroller__right"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-scroll-right" data-svoge-class=""> </div> <div class="__scroll_container js-gridscroller__container"> <div class="__scroll_inner-container js-gridscroller__inner-container"> <div class="__mover js-gridscroller__mover"> <table class="__table bc_c"> {{#event.recurring_events_grid}} <tr> {{#cells}} <td class="__outer_cell {{#is_header}}__header js-gridscroller__header{{/is_header}} {{#is_weekend}}__header_weekend{{/is_weekend}} js-gridscroller__cell"> <div class="__cell"> {{#is_header}} <div class="__wday">{{day_of_week}}</div> <div class="__day">{{day_month}}</div> {{/is_header}} {{#events}} <div class="js-date-choice __time {{#isCurrent}}__time_active{{/isCurrent}} {{#unavaliable}}__time_inactive{{/unavaliable}}" data-event-id="{{id}}" {{#tickets_limited}}data-event-tickets-left="{{tickets_left}}" data-event-tickers-reglimit="{{tickers_reglimit}}"{{/tickets_limited}}> {{time}} </div> {{/events}} </div> </td> {{/cells}} </tr> {{/event.recurring_events_grid}} {{^event.recurring_events_by_day}} {{{event.texts.reg_closed}}} {{/event.recurring_events_by_day}} </table> </div> </div> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.success='<div class="i-page i-jquery i-less i-bootstrap"> {{> _header_image}} <div class="b-registration__section b-registration__section_indent b-registration__section_text"> <h2 class="b-unit__header b-unit__header_size_mid"> Спасибо за регистрацию! </h2> </div> {{#order.charity_payment.paid}} <div class="b-registration__section b-registration__section_success l-units"> {{> _charity_ok_text }} </div> {{/order.charity_payment.paid}} <div class="b-registration__section b-registration__section_text b-registration__section_indent"> {{{event.texts.reg_success}}} </div> <div class="b-registration__section b-registration__section_indent"> {{> _registrant}} </div> <div class="b-registration__section"> {{> _order}} </div> {{#event.has_checkout_promotions}} <div class="b-registration__section b-registration__section_indent b-registration__section_text"> <h2 class="b-unit__header b-unit__header_size_mid"> Возможно, вас заинтересует: </h2> </div> <div class="b-registration__section b-registration__section_indent"> <div class="b-promoted-links"> {{#event.checkout_promotions}} <div class="b-promoted-links__block"> <a href="{{url}}" class="b-promoted-links__img" style="background-image:url({{img_src}})" target="_blank"></a> <a href="{{url}}" class="b-promoted-links__link" target="_blank"> {{text}} </a> </div> {{/event.checkout_promotions}} </div> </div> {{/event.has_checkout_promotions}} {{#isInTimepad}} {{#event.uses_ads}} {{#order.uses_ads}} {{#order.show_diploma}} {{> _banner_diploma}} {{/order.show_diploma}} {{^order.show_diploma}} {{> _banner_flocktory}} {{/order.show_diploma}} {{/order.uses_ads}} {{/event.uses_ads}} {{/isInTimepad}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.tickets='<div class="i-page"> {{> _header_image}} <div class="b-registration__section b-registration__section_success"> <h3 class="b-unit__header b-unit__header_size_mid_small"> {{#order.payment}}Оплата успешна!{{/order.payment}} {{^order.payment}}Спасибо за регистрацию!{{/order.payment}} </h3> <p> Распечатайте ваши билеты прямо сейчас, если у вас есть возможность. Мы также отправили ссылки на них на почту <a href="mailto:{{order.email}}">{{order.email}}</a> Если билеты не пришли, пожалуйста, напишите нам об этом на <a href="mailto:support@timepad.ru">support@timepad.ru</a>. В письме обязательно укажите событие, на которое вы их покупали. </p> {{#order.charity_payment.paid}} {{> _charity_ok_text }} {{/order.charity_payment.paid}} </div> <div class="b-registration__section b-registration__section_text b-registration__section_indent"> {{{event.texts.reg_success}}} </div> <div class="b-registration__section"> <h2 class="b-unit__header b-unit__header_size_large"> Ваши билеты. Распечатайте их сейчас. </h2> </div> <div class="b-registration__section js-tickets"> {{#order.tickets}} <div class="b-tickets-table__row js-ticket b-printable-ticket" data-ticket-id="{{id}}"> <button class="js-print-ticket b-printable-ticket__button">Распечатать</button> <span class="b-reg-table__text">{{{cat_name}}}</span> <span class="help-block b-tickets-table__description"> <a href="{{view_link}}" target="_blank" class="js-ticket-view-link">Билет №{{code}}</a> </span> {{#personal_link}} <div class="b-reg-table__delimiter"></div> <span class="b-reg-table__text b-reg-table__text_extra">{{personal_link_title}}</span> <span class="help-block b-tickets-table__description"> <a href="{{personal_link}}" target="_blank" class="js-ticket-view-link">{{personal_link}}</a> </span> {{/personal_link}} </div> {{/order.tickets}} </div> {{#event.has_checkout_promotions}} <div class="b-registration__section b-registration__section_indent b-registration__section_text"> <h2 class="b-unit__header b-unit__header_size_mid"> Возможно, вас заинтересует: </h2> </div> <div class="b-registration__section b-registration__section_indent"> <div class="b-promoted-links"> {{#event.checkout_promotions}} <div class="b-promoted-links__block"> <a href="{{url}}" class="b-promoted-links__img" style="background-image:url({{img_src}})" target="_blank"></a> <a href="{{url}}" class="b-promoted-links__link" target="_blank"> {{text}} </a> </div> {{/event.checkout_promotions}} </div> </div> {{/event.has_checkout_promotions}} {{> _branding.thanks}} {{#isInTimepad}} {{#event.uses_ads}} {{#order.uses_ads}} {{#order.show_diploma}} {{> _banner_diploma}} {{/order.show_diploma}} {{^order.show_diploma}} {{^order.payment}} {{> _banner_flocktory}} {{/order.payment}} {{/order.show_diploma}} {{/order.uses_ads}} {{/event.uses_ads}} {{/isInTimepad}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.tlen='<div class="i-page i-jquery i-less i-bootstrap"> <div class="b-registration__section" style="border-bottom: none;"> <h2 class="b-unit__header b-unit__header_size_mid"> Регистрация на событие закрыта </h2> <div class="b-registration__notice"> {{{event.texts.reg_closed}}} </div> </div> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.widget_error='<div style="margin: 1em;" class="i-page"> <h2>{{error.header}}</h2> <p> {{error.message}} {{#error.support}}Пожалуйста, сообщите об этом по адресу <a href="mailto:support@timepad.ru">support@timepad.ru</a> и пришлите ссылку на эту страницу.{{/error.support}} </p> {{#error.fallback}} <p style="margin-top: 1em;">Вы можете попробовать зарегистрироваться на событие через систему TimePad:</p> <p style="margin: .6em 0;"><a href="{{error.fallback_url}}" class="btn btn-large btn-info" target="_blank">Перейти к регистрации</a></p> {{/error.fallback}} </div> ';